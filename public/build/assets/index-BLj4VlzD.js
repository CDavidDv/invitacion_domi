import{x as ae,Q as ue,d as v,k as ce,p as pe,o as g,e as f,a as s,l as k,y as ge,q as E,f as $,t as S,n as oe,u,F as fe,h as he,g as me,s as O,c as _e,w as ve,b as ye}from"./app-0XMUyBnA.js";import{S as U}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{_ as xe}from"./AppLayout-DhSlKG31.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";class N{constructor(e,t,a){this.name=e,this.definition=t,this.bindings=t.bindings??{},this.wheres=t.wheres??{},this.config=a}get template(){const e=`${this.origin}/${this.definition.uri}`.replace(/\/+$/,"");return e===""?"/":e}get origin(){return this.config.absolute?this.definition.domain?`${this.config.url.match(/^\w+:\/\//)[0]}${this.definition.domain}${this.config.port?`:${this.config.port}`:""}`:this.config.url:""}get parameterSegments(){var e;return((e=this.template.match(/{[^}?]+\??}/g))==null?void 0:e.map(t=>({name:t.replace(/{|\??}/g,""),required:!/\?}$/.test(t)})))??[]}matchesUrl(e){if(!this.definition.methods.includes("GET"))return!1;const t=this.template.replace(/(\/?){([^}?]*)(\??)}/g,(n,c,y,b)=>{var h;const x=`(?<${y}>${((h=this.wheres[y])==null?void 0:h.replace(/(^\^)|(\$$)/g,""))||"[^/?]+"})`;return b?`(${c}${x})?`:`${c}${x}`}).replace(/^\w+:\/\//,""),[a,o]=e.replace(/^\w+:\/\//,"").split("?"),i=new RegExp(`^${t}/?$`).exec(decodeURI(a));if(i){for(const n in i.groups)i.groups[n]=typeof i.groups[n]=="string"?decodeURIComponent(i.groups[n]):i.groups[n];return{params:i.groups,query:ae.parse(o)}}return!1}compile(e){return this.parameterSegments.length?this.template.replace(/{([^}?]+)(\??)}/g,(a,o,i)=>{if(!i&&[null,void 0].includes(e[o]))throw new Error(`Ziggy error: '${o}' parameter is required for route '${this.name}'.`);if(this.wheres[o]&&!new RegExp(`^${i?`(${this.wheres[o]})?`:this.wheres[o]}$`).test(e[o]??""))throw new Error(`Ziggy error: '${o}' parameter '${e[o]}' does not match required format '${this.wheres[o]}' for route '${this.name}'.`);return encodeURI(e[o]??"").replace(/%7C/g,"|").replace(/%25/g,"%").replace(/\$/g,"%24")}).replace(this.config.absolute?/(\.[^/]+?)(\/\/)/:/(^)(\/\/)/,"$1/").replace(/\/+$/,""):this.template}}class be extends String{constructor(e,t,a=!0,o){if(super(),this._config=o??(typeof Ziggy<"u"?Ziggy:globalThis==null?void 0:globalThis.Ziggy),this._config={...this._config,absolute:a},e){if(!this._config.routes[e])throw new Error(`Ziggy error: route '${e}' is not in the route list.`);this._route=new N(e,this._config.routes[e],this._config),this._params=this._parse(t)}}toString(){const e=Object.keys(this._params).filter(t=>!this._route.parameterSegments.some(({name:a})=>a===t)).filter(t=>t!=="_query").reduce((t,a)=>({...t,[a]:this._params[a]}),{});return this._route.compile(this._params)+ae.stringify({...e,...this._params._query},{addQueryPrefix:!0,arrayFormat:"indices",encodeValuesOnly:!0,skipNulls:!0,encoder:(t,a)=>typeof t=="boolean"?Number(t):a(t)})}_unresolve(e){e?this._config.absolute&&e.startsWith("/")&&(e=this._location().host+e):e=this._currentUrl();let t={};const[a,o]=Object.entries(this._config.routes).find(([i,n])=>t=new N(i,n,this._config).matchesUrl(e))||[void 0,void 0];return{name:a,...t,route:o}}_currentUrl(){const{host:e,pathname:t,search:a}=this._location();return(this._config.absolute?e+t:t.replace(this._config.url.replace(/^\w*:\/\/[^/]+/,""),"").replace(/^\/+/,"/"))+a}current(e,t){const{name:a,params:o,query:i,route:n}=this._unresolve();if(!e)return a;const c=new RegExp(`^${e.replace(/\./g,"\\.").replace(/\*/g,".*")}$`).test(a);if([null,void 0].includes(t)||!c)return c;const y=new N(a,n,this._config);t=this._parse(t,y);const b={...o,...i};if(Object.values(t).every(h=>!h)&&!Object.values(b).some(h=>h!==void 0))return!0;const x=(h,m)=>Object.entries(h).every(([_,w])=>Array.isArray(w)&&Array.isArray(m[_])?w.every(F=>m[_].includes(F)):typeof w=="object"&&typeof m[_]=="object"&&w!==null&&m[_]!==null?x(w,m[_]):m[_]==w);return x(t,b)}_location(){var o,i,n;const{host:e="",pathname:t="",search:a=""}=typeof window<"u"?window.location:{};return{host:((o=this._config.location)==null?void 0:o.host)??e,pathname:((i=this._config.location)==null?void 0:i.pathname)??t,search:((n=this._config.location)==null?void 0:n.search)??a}}get params(){const{params:e,query:t}=this._unresolve();return{...e,...t}}get routeParams(){return this._unresolve().params}get queryParams(){return this._unresolve().query}has(e){return Object.keys(this._config.routes).includes(e)}_parse(e={},t=this._route){e??(e={}),e=["string","number"].includes(typeof e)?[e]:e;const a=t.parameterSegments.filter(({name:o})=>!this._config.defaults[o]);return Array.isArray(e)?e=e.reduce((o,i,n)=>a[n]?{...o,[a[n].name]:i}:typeof i=="object"?{...o,...i}:{...o,[i]:""},{}):a.length===1&&!e[a[0].name]&&(e.hasOwnProperty(Object.values(t.bindings)[0])||e.hasOwnProperty("id"))&&(e={[a[0].name]:e}),{...this._defaults(t),...this._substituteBindings(e,t)}}_defaults(e){return e.parameterSegments.filter(({name:t})=>this._config.defaults[t]).reduce((t,{name:a},o)=>({...t,[a]:this._config.defaults[a]}),{})}_substituteBindings(e,{bindings:t,parameterSegments:a}){return Object.entries(e).reduce((o,[i,n])=>{if(!n||typeof n!="object"||Array.isArray(n)||!a.some(({name:c})=>c===i))return{...o,[i]:n};if(!n.hasOwnProperty(t[i]))if(n.hasOwnProperty("id"))t[i]="id";else throw new Error(`Ziggy error: object passed as '${i}' parameter is missing route model binding key '${t[i]}'.`);return{...o,[i]:n[t[i]]}},{})}valueOf(){return this.toString()}}function we(j,e,t,a){const o=new be(j,e,t,a);return j?o.toString():o}const $e={class:"min-h-screen py-6 flex rounded-2xl border-0 flex-col justify-center sm:py-12"},Se={class:"relative py-3 sm:max-w-xl sm:mx-auto w-full px-4 sm:px-0"},Ce={class:"relative px-4 py-10 bg-white shadow-lg rounded-3xl sm:p-20"},je={class:"flex flex-col md:flex-row items-center gap-4 mb-8"},ke={class:"w-full gap-2 flex flex-col items-center"},Ee={class:"flex gap-2"},Fe={key:0,class:"text-red-500 font-bold mt-2"},Pe={key:1,class:"mb-6"},Oe={class:"flex space-x-2"},Ue=["disabled"],Ne={key:2,class:"mb-6"},De={class:"flex space-x-2"},Te=["disabled"],qe={class:"bg-gray-50 p-4 rounded-lg mb-6"},Ve={class:"grid grid-cols-2 gap-4"},Ae={key:0},Re={class:"font-medium"},Be={key:1},Ie={class:"font-medium"},Me={class:"font-medium"},Ze={class:"font-medium"},Le={class:"font-medium"},ze={class:"mb-6"},Ge={class:"overflow-x-auto"},Ye={class:"min-w-full divide-y divide-gray-200"},Qe={class:"bg-white divide-y divide-gray-200"},We={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},He={class:"text-gray-500 uppercase"},Je={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ke={key:3,class:"text-center text-gray-500"},Xe={__name:"Corte",setup(j){var D,T;const{props:e}=ue(),t=v("day"),a=new Date,o=v(a.getFullYear()+"-"+String(a.getMonth()+1).padStart(2,"0")+"-"+String(a.getDate()).padStart(2,"0")),i=v(null),n=v(null),c=v(((D=e==null?void 0:e.corte)==null?void 0:D.dinero_inicio)||0),y=v(((T=e==null?void 0:e.corte)==null?void 0:T.dinero_final)||0),b=v(0),x=v(0),h=v(e.productosVendidos||[]),m=v(!1),_=v(""),w=ce(()=>{const l=new Date,r=l.getFullYear()+"-"+String(l.getMonth()+1).padStart(2,"0")+"-"+String(l.getDate()).padStart(2,"0");return t.value==="day"&&o.value===r});console.log(e.ventas);const F=()=>{m.value=!0,_.value="";let l=t.value,r=null;l==="day"?r=o.value:l==="week"?r=i.value:l==="month"&&(r=n.value),O.post("/corte-caja/filtro",{filter:l,value:r},{preserveScroll:!0,onSuccess(p){b.value=p.props.cashPayments,x.value=p.props.cardPayments,h.value=p.props.productsUsed,c.value=p.props.initialCash||0,y.value=p.props.finalCash||0,m.value=!1,C("success","Filtro actualizado correctamente")},onError(p){C("error",p.props.flash.error||"Error al obtener datos con este filtro"),_.value="Ocurrió un error al obtener los datos. Inténtalo de nuevo.",m.value=!1}})},ie=()=>{t.value="day";const l=new Date;o.value=l.getFullYear()+"-"+String(l.getMonth()+1).padStart(2,"0")+"-"+String(l.getDate()).padStart(2,"0"),i.value=null,n.value=null,F()},ne=()=>{b.value=e.ventas.reduce((l,r)=>r.metodo_pago==="efectivo"?Number(l)+Number(r.total):Number(l),0),x.value=e.ventas.reduce((l,r)=>r.metodo_pago==="tarjeta"?Number(l)+Number(r.total):Number(l),0)},C=(l,r)=>{U.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:p=>{p.addEventListener("mouseenter",U.stopTimer),p.addEventListener("mouseleave",U.resumeTimer)}}).fire({icon:l,title:r})},le=()=>{const l={sucursal_id:e==null?void 0:e.sucursal_id,usuario_id:e==null?void 0:e.usuario_id,fecha:o.value,dinero_inicio:c.value};O.post(we("corte-caja.guardar-inicial"),l,{preserveScroll:!0,onSuccess(r){r.props.flash.error?C("error",r.props.flash.error||"Error al guardar la cantidad inicial"):C("success","Cantidad inicial guardada correctamente")},onError(r){C("error",r.error||"Error al guardar la cantidad inicial")}})},de=()=>{const l={sucursal_id:e==null?void 0:e.sucursal_id,usuario_id:e==null?void 0:e.usuario_id,fecha:o.value,dinero_final:y.value};O.post("/corte-caja/guardar-final",l,{preserveScroll:!0,onSuccess(r){r.props.flash.error?C("error",r.props.flash.error||"Error al guardar la cantidad inicial"):C("success","Cantidad final guardada correctamente")},onError(r){C("error",r.error||"Error al guardar la cantidad inicial")}})};pe(()=>{ne()});const P=l=>parseFloat(l).toFixed(2);return(l,r)=>{var p,q,V,A,R,B,I,M,Z,L,z,G,Y,Q,W,H,J,K,X,ee,te,re,se;return g(),f("div",$e,[s("div",Se,[s("div",Ce,[r[18]||(r[18]=s("h1",{class:"text-3xl font-bold mb-6 text-center"},"Corte de Caja",-1)),s("div",je,[s("div",ke,[r[7]||(r[7]=s("label",{for:"filter",class:"font-bold"},"Filtrar por:",-1)),s("div",Ee,[k(s("select",{class:"ml-1 py-0 rounded",id:"filter","onUpdate:modelValue":r[0]||(r[0]=d=>t.value=d)},r[6]||(r[6]=[s("option",{value:"day"},"Día",-1),s("option",{value:"week"},"Semana",-1),s("option",{value:"month"},"Mes",-1)]),512),[[ge,t.value]]),t.value==="day"?k((g(),f("input",{key:0,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"date","onUpdate:modelValue":r[1]||(r[1]=d=>o.value=d)},null,512)),[[E,o.value]]):$("",!0),t.value==="week"?k((g(),f("input",{key:1,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"week","onUpdate:modelValue":r[2]||(r[2]=d=>i.value=d)},null,512)),[[E,i.value]]):$("",!0),t.value==="month"?k((g(),f("input",{key:2,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"month","onUpdate:modelValue":r[3]||(r[3]=d=>n.value=d)},null,512)),[[E,n.value]]):$("",!0)]),s("div",{class:"flex gap-1"},[s("button",{class:"text-sm rounded-lg shadow-lg px-3 py-2 bg-orange-500 text-white hover:bg-orange-600",onClick:F},"Aplicar Filtro"),s("button",{class:"text-sm rounded-lg shadow-lg px-3 py-2 bg-gray-500 text-white hover:bg-gray-600",onClick:ie},"Limpiar Filtro")])])]),_.value?(g(),f("div",Fe,S(_.value),1)):$("",!0),w.value?(g(),f("div",Pe,[r[8]||(r[8]=s("label",{for:"initialCash",class:"block text-sm font-medium text-gray-700"},"Cantidad Inicial en Caja",-1)),s("div",Oe,[k(s("input",{type:"number",id:"initialCash","onUpdate:modelValue":r[4]||(r[4]=d=>c.value=d),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"0",step:"0.01",placeholder:"Ingrese cantidad"},null,512),[[E,c.value]]),s("button",{onClick:le,class:oe({"px-4 py-2 rounded-md text-white hover:bg-orange-600 bg-orange-500":((p=u(e))==null?void 0:p.corte)===null&&((V=(q=u(e))==null?void 0:q.corte)==null?void 0:V.dinero_inicio)===null,"bg-gray-500 px-4 py-2 rounded-md text-gray-300 cursor-not-allowed":((A=u(e))==null?void 0:A.corte)!==null&&((B=(R=u(e))==null?void 0:R.corte)==null?void 0:B.dinero_inicio)!==null,"px-4 py-2 rounded-md text-white hover:bg-orange-600 bg-orange-500":((I=u(e))==null?void 0:I.corte)===null}),disabled:((M=u(e))==null?void 0:M.corte)!==null||((L=(Z=u(e))==null?void 0:Z.corte)==null?void 0:L.dinero_inicio)===null}," Guardar ",10,Ue)])])):$("",!0),w.value?(g(),f("div",Ne,[r[9]||(r[9]=s("label",{for:"finalCash",class:"block text-sm font-medium text-gray-700"},"Cantidad Final en Caja",-1)),s("div",De,[k(s("input",{type:"number",id:"finalCash","onUpdate:modelValue":r[5]||(r[5]=d=>y.value=d),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"0",step:"0.01",placeholder:"Ingrese cantidad"},null,512),[[E,y.value]]),s("button",{onClick:de,class:oe({"px-4 py-2 rounded-md text-white hover:bg-orange-600 bg-orange-500":((z=u(e))==null?void 0:z.corte)!==null&&((Y=(G=u(e))==null?void 0:G.corte)==null?void 0:Y.dinero_final)===null,"bg-gray-500 px-4 py-2 rounded-md text-gray-300 cursor-not-allowed":((Q=u(e))==null?void 0:Q.corte)!==null&&((H=(W=u(e))==null?void 0:W.corte)==null?void 0:H.dinero_final)!==null,"bg-orange-500":((J=u(e))==null?void 0:J.corte)!==null&&((X=(K=u(e))==null?void 0:K.corte)==null?void 0:X.dinero_final)===null,"px-4 py-2 rounded-md text-white hover:bg-orange-600 bg-orange-500":((ee=u(e))==null?void 0:ee.corte)===null}),disabled:((te=u(e))==null?void 0:te.corte)!==null&&((se=(re=u(e))==null?void 0:re.corte)==null?void 0:se.dinero_final)!==null}," Guardar ",10,Te)])])):$("",!0),s("div",qe,[r[15]||(r[15]=s("h2",{class:"text-xl font-semibold mb-4"},"Resumen Financiero",-1)),s("div",Ve,[t.value==="day"?(g(),f("div",Ae,[r[10]||(r[10]=s("p",{class:"text-sm text-gray-600"},"Dinero inicial:",-1)),s("p",Re,"$"+S(P(c.value)),1)])):$("",!0),t.value==="day"?(g(),f("div",Be,[r[11]||(r[11]=s("p",{class:"text-sm text-gray-600"},"Dinero final:",-1)),s("p",Ie,"$"+S(P(y.value)),1)])):$("",!0),s("div",null,[r[12]||(r[12]=s("p",{class:"text-sm text-gray-600"},"Efectivo:",-1)),s("p",Me,"$"+S(P(b.value)),1)]),s("div",null,[r[13]||(r[13]=s("p",{class:"text-sm text-gray-600"},"Tarjetas:",-1)),s("p",Ze,"$"+S(x.value),1)]),s("div",null,[r[14]||(r[14]=s("p",{class:"text-sm text-gray-600"},"Total ventas:",-1)),s("p",Le,"$"+S(Number(b.value)+Number(x.value)),1)])])]),s("div",ze,[r[17]||(r[17]=s("h2",{class:"text-xl font-semibold mb-4"},"Productos Utilizados",-1)),s("div",Ge,[s("table",Ye,[r[16]||(r[16]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Producto"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cantidad")])],-1)),s("tbody",Qe,[(g(!0),f(fe,null,he(h.value,d=>(g(),f("tr",{key:d.producto_id},[s("td",We,[me(S(d.producto.nombre)+" - ",1),s("small",He,S(d.producto.detalle),1)]),s("td",Je,S(d.total_vendido),1)]))),128))])])])]),m.value?(g(),f("div",Ke,"Cargando...")):$("",!0)])])])}}},et={class:"py-6"},tt={class:"max-w-7xl w-full mx-auto sm:px-6 lg:px-8 rounded-xl"},rt={class:"overflow-scroll md:overflow-hidden rounded-xl"},nt={__name:"index",setup(j){return(e,t)=>(g(),_e(xe,{title:"Tablero principal"},{default:ve(()=>[s("div",et,[s("div",tt,[s("div",rt,[ye(Xe)])])])]),_:1}))}};export{nt as default};
