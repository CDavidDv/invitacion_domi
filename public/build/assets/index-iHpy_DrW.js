import{x as K,Q as se,d as m,k as oe,p as ie,o as h,e as y,a as s,l as N,y as ae,q as k,f as C,t as w,n as J,u as S,F as ne,h as le,g as de,s as P,c as ue,w as ce,b as pe}from"./app-CjNhnG7k.js";import{S as O}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{_ as fe}from"./AppLayout-R2WWESQD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";class U{constructor(e,t,i){this.name=e,this.definition=t,this.bindings=t.bindings??{},this.wheres=t.wheres??{},this.config=i}get template(){const e=`${this.origin}/${this.definition.uri}`.replace(/\/+$/,"");return e===""?"/":e}get origin(){return this.config.absolute?this.definition.domain?`${this.config.url.match(/^\w+:\/\//)[0]}${this.definition.domain}${this.config.port?`:${this.config.port}`:""}`:this.config.url:""}get parameterSegments(){var e;return((e=this.template.match(/{[^}?]+\??}/g))==null?void 0:e.map(t=>({name:t.replace(/{|\??}/g,""),required:!/\?}$/.test(t)})))??[]}matchesUrl(e){if(!this.definition.methods.includes("GET"))return!1;const t=this.template.replace(/(\/?){([^}?]*)(\??)}/g,(n,c,_,x)=>{var p;const v=`(?<${_}>${((p=this.wheres[_])==null?void 0:p.replace(/(^\^)|(\$$)/g,""))||"[^/?]+"})`;return x?`(${c}${v})?`:`${c}${v}`}).replace(/^\w+:\/\//,""),[i,o]=e.replace(/^\w+:\/\//,"").split("?"),a=new RegExp(`^${t}/?$`).exec(decodeURI(i));if(a){for(const n in a.groups)a.groups[n]=typeof a.groups[n]=="string"?decodeURIComponent(a.groups[n]):a.groups[n];return{params:a.groups,query:K.parse(o)}}return!1}compile(e){return this.parameterSegments.length?this.template.replace(/{([^}?]+)(\??)}/g,(i,o,a)=>{if(!a&&[null,void 0].includes(e[o]))throw new Error(`Ziggy error: '${o}' parameter is required for route '${this.name}'.`);if(this.wheres[o]&&!new RegExp(`^${a?`(${this.wheres[o]})?`:this.wheres[o]}$`).test(e[o]??""))throw new Error(`Ziggy error: '${o}' parameter '${e[o]}' does not match required format '${this.wheres[o]}' for route '${this.name}'.`);return encodeURI(e[o]??"").replace(/%7C/g,"|").replace(/%25/g,"%").replace(/\$/g,"%24")}).replace(this.config.absolute?/(\.[^/]+?)(\/\/)/:/(^)(\/\/)/,"$1/").replace(/\/+$/,""):this.template}}class ge extends String{constructor(e,t,i=!0,o){if(super(),this._config=o??(typeof Ziggy<"u"?Ziggy:globalThis==null?void 0:globalThis.Ziggy),this._config={...this._config,absolute:i},e){if(!this._config.routes[e])throw new Error(`Ziggy error: route '${e}' is not in the route list.`);this._route=new U(e,this._config.routes[e],this._config),this._params=this._parse(t)}}toString(){const e=Object.keys(this._params).filter(t=>!this._route.parameterSegments.some(({name:i})=>i===t)).filter(t=>t!=="_query").reduce((t,i)=>({...t,[i]:this._params[i]}),{});return this._route.compile(this._params)+K.stringify({...e,...this._params._query},{addQueryPrefix:!0,arrayFormat:"indices",encodeValuesOnly:!0,skipNulls:!0,encoder:(t,i)=>typeof t=="boolean"?Number(t):i(t)})}_unresolve(e){e?this._config.absolute&&e.startsWith("/")&&(e=this._location().host+e):e=this._currentUrl();let t={};const[i,o]=Object.entries(this._config.routes).find(([a,n])=>t=new U(a,n,this._config).matchesUrl(e))||[void 0,void 0];return{name:i,...t,route:o}}_currentUrl(){const{host:e,pathname:t,search:i}=this._location();return(this._config.absolute?e+t:t.replace(this._config.url.replace(/^\w*:\/\/[^/]+/,""),"").replace(/^\/+/,"/"))+i}current(e,t){const{name:i,params:o,query:a,route:n}=this._unresolve();if(!e)return i;const c=new RegExp(`^${e.replace(/\./g,"\\.").replace(/\*/g,".*")}$`).test(i);if([null,void 0].includes(t)||!c)return c;const _=new U(i,n,this._config);t=this._parse(t,_);const x={...o,...a};if(Object.values(t).every(p=>!p)&&!Object.values(x).some(p=>p!==void 0))return!0;const v=(p,f)=>Object.entries(p).every(([g,b])=>Array.isArray(b)&&Array.isArray(f[g])?b.every(E=>f[g].includes(E)):typeof b=="object"&&typeof f[g]=="object"&&b!==null&&f[g]!==null?v(b,f[g]):f[g]==b);return v(t,x)}_location(){var o,a,n;const{host:e="",pathname:t="",search:i=""}=typeof window<"u"?window.location:{};return{host:((o=this._config.location)==null?void 0:o.host)??e,pathname:((a=this._config.location)==null?void 0:a.pathname)??t,search:((n=this._config.location)==null?void 0:n.search)??i}}get params(){const{params:e,query:t}=this._unresolve();return{...e,...t}}get routeParams(){return this._unresolve().params}get queryParams(){return this._unresolve().query}has(e){return Object.keys(this._config.routes).includes(e)}_parse(e={},t=this._route){e??(e={}),e=["string","number"].includes(typeof e)?[e]:e;const i=t.parameterSegments.filter(({name:o})=>!this._config.defaults[o]);return Array.isArray(e)?e=e.reduce((o,a,n)=>i[n]?{...o,[i[n].name]:a}:typeof a=="object"?{...o,...a}:{...o,[a]:""},{}):i.length===1&&!e[i[0].name]&&(e.hasOwnProperty(Object.values(t.bindings)[0])||e.hasOwnProperty("id"))&&(e={[i[0].name]:e}),{...this._defaults(t),...this._substituteBindings(e,t)}}_defaults(e){return e.parameterSegments.filter(({name:t})=>this._config.defaults[t]).reduce((t,{name:i},o)=>({...t,[i]:this._config.defaults[i]}),{})}_substituteBindings(e,{bindings:t,parameterSegments:i}){return Object.entries(e).reduce((o,[a,n])=>{if(!n||typeof n!="object"||Array.isArray(n)||!i.some(({name:c})=>c===a))return{...o,[a]:n};if(!n.hasOwnProperty(t[a]))if(n.hasOwnProperty("id"))t[a]="id";else throw new Error(`Ziggy error: object passed as '${a}' parameter is missing route model binding key '${t[a]}'.`);return{...o,[a]:n[t[a]]}},{})}valueOf(){return this.toString()}}function me(j,e,t,i){const o=new ge(j,e,t,i);return j?o.toString():o}const he={class:"min-h-screen py-6 flex rounded-2xl border-0 flex-col justify-center sm:py-12"},_e={class:"relative py-3 sm:max-w-xl sm:mx-auto w-full px-4 sm:px-0"},ve={class:"relative px-4 py-10 bg-white shadow-lg rounded-3xl sm:p-20"},ye={class:"flex flex-col md:flex-row items-center gap-4 mb-8"},xe={class:"w-full gap-2 flex flex-col items-center"},be={class:"flex gap-2"},we={key:0,class:"text-red-500 font-bold mt-2"},$e={key:1,class:"mb-6"},Se={class:"flex space-x-2"},Ce=["disabled"],je={key:2,class:"mb-6"},Ne={class:"flex space-x-2"},ke=["disabled"],Ee={class:"bg-gray-50 p-4 rounded-lg mb-6"},Fe={class:"grid grid-cols-2 gap-4"},Pe={class:"font-medium"},Oe={class:"font-medium"},Ue={class:"font-medium"},De={class:"font-medium"},Te={class:"font-medium"},qe={class:"mb-6"},Ve={class:"overflow-x-auto"},Ae={class:"min-w-full divide-y divide-gray-200"},Re={class:"bg-white divide-y divide-gray-200"},Be={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Ie={class:"text-gray-500 uppercase"},Me={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ze={key:3,class:"text-center text-gray-500"},Le={__name:"Corte",setup(j){var D,T;const{props:e}=se(),t=m("day"),i=new Date,o=m(i.getFullYear()+"-"+String(i.getMonth()+1).padStart(2,"0")+"-"+String(i.getDate()).padStart(2,"0")),a=m(null),n=m(null),c=m(((D=e==null?void 0:e.corte[0])==null?void 0:D.dinero_inicio)||0),_=m(((T=e==null?void 0:e.corte[0])==null?void 0:T.dinero_final)||0),x=m(0),v=m(0),p=m(e.productosVendidos||[]),f=m(!1),g=m(""),b=oe(()=>{const l=new Date,r=l.getFullYear()+"-"+String(l.getMonth()+1).padStart(2,"0")+"-"+String(l.getDate()).padStart(2,"0");return t.value==="day"&&o.value===r}),E=()=>{f.value=!0,g.value="";let l=t.value,r=null;l==="day"?r=o.value:l==="week"?r=a.value:l==="month"&&(r=n.value),P.post("/corte-caja/filtro",{filter:l,value:r},{preserveScroll:!0,onSuccess(u){console.log(u),x.value=u.props.cashPayments,v.value=u.props.cardPayments,p.value=u.props.productsUsed,c.value=u.props.initialCash||0,_.value=u.props.finalCash||0,f.value=!1,$("success","Filtro actualizado correctamente")},onError(u){$("error",u.props.flash.error||"Error al obtener datos con este filtro"),g.value="Ocurrió un error al obtener los datos. Inténtalo de nuevo.",f.value=!1}})},X=()=>{t.value="day";const l=new Date;o.value=l.getFullYear()+"-"+String(l.getMonth()+1).padStart(2,"0")+"-"+String(l.getDate()).padStart(2,"0"),a.value=null,n.value=null,E()},ee=()=>{x.value=e.ventas.reduce((l,r)=>r.metodo_pago==="efectivo"?Number(l)+Number(r.total):Number(l),0),v.value=e.ventas.reduce((l,r)=>r.metodo_pago==="tarjeta"?Number(l)+Number(r.total):Number(l),0)},$=(l,r)=>{O.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:u=>{u.addEventListener("mouseenter",O.stopTimer),u.addEventListener("mouseleave",O.resumeTimer)}}).fire({icon:l,title:r})},te=()=>{const l={sucursal_id:e==null?void 0:e.sucursal_id,usuario_id:e==null?void 0:e.usuario_id,fecha:o.value,dinero_inicio:c.value};P.post(me("corte-caja.guardar-inicial"),l,{preserveScroll:!0,onSuccess(r){r.props.flash.error?$("error",r.props.flash.error||"Error al guardar la cantidad inicial"):$("success","Cantidad inicial guardada correctamente")},onError(r){$("error",r.error||"Error al guardar la cantidad inicial")}})},re=()=>{const l={sucursal_id:e==null?void 0:e.sucursal_id,usuario_id:e==null?void 0:e.usuario_id,fecha:o.value,dinero_final:_.value};P.post("/corte-caja/guardar-final",l,{preserveScroll:!0,onSuccess(r){r.props.flash.error?$("error",r.props.flash.error||"Error al guardar la cantidad inicial"):$("success","Cantidad inicial guardada correctamente")},onError(r){$("error",r.error||"Error al guardar la cantidad inicial")}})};ie(()=>{ee()});const F=l=>parseFloat(l).toFixed(2);return(l,r)=>{var u,q,V,A,R,B,I,M,Z,L,z,G,Y,Q,W,H;return h(),y("div",he,[s("div",_e,[s("div",ve,[r[18]||(r[18]=s("h1",{class:"text-3xl font-bold mb-6 text-center"},"Corte de Caja",-1)),s("div",ye,[s("div",xe,[r[7]||(r[7]=s("label",{for:"filter",class:"font-bold"},"Filtrar por:",-1)),s("div",be,[N(s("select",{class:"ml-1 py-0 rounded",id:"filter","onUpdate:modelValue":r[0]||(r[0]=d=>t.value=d)},r[6]||(r[6]=[s("option",{value:"day"},"Día",-1),s("option",{value:"week"},"Semana",-1),s("option",{value:"month"},"Mes",-1)]),512),[[ae,t.value]]),t.value==="day"?N((h(),y("input",{key:0,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"date","onUpdate:modelValue":r[1]||(r[1]=d=>o.value=d)},null,512)),[[k,o.value]]):C("",!0),t.value==="week"?N((h(),y("input",{key:1,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"week","onUpdate:modelValue":r[2]||(r[2]=d=>a.value=d)},null,512)),[[k,a.value]]):C("",!0),t.value==="month"?N((h(),y("input",{key:2,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"month","onUpdate:modelValue":r[3]||(r[3]=d=>n.value=d)},null,512)),[[k,n.value]]):C("",!0)]),s("div",{class:"flex gap-1"},[s("button",{class:"text-sm rounded-lg shadow-lg px-3 py-2 bg-orange-500 text-white hover:bg-orange-600",onClick:E},"Aplicar Filtro"),s("button",{class:"text-sm rounded-lg shadow-lg px-3 py-2 bg-gray-500 text-white hover:bg-gray-600",onClick:X},"Limpiar Filtro")])])]),g.value?(h(),y("div",we,w(g.value),1)):C("",!0),b.value?(h(),y("div",$e,[r[8]||(r[8]=s("label",{for:"initialCash",class:"block text-sm font-medium text-gray-700"},"Cantidad Inicial en Caja",-1)),s("div",Se,[N(s("input",{type:"number",id:"initialCash","onUpdate:modelValue":r[4]||(r[4]=d=>c.value=d),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"0",step:"0.01",placeholder:"Ingrese cantidad"},null,512),[[k,c.value]]),s("button",{onClick:te,class:J({"px-4 py-2 rounded-md text-white hover:bg-orange-600":Number(((q=(u=S(e))==null?void 0:u.corte[0])==null?void 0:q.dinero_inicio)||0)<=0,"bg-gray-500 px-4 py-2 rounded-md text-gray-300 cursor-not-allowed":Number(((A=(V=S(e))==null?void 0:V.corte[0])==null?void 0:A.dinero_inicio)||0)>0,"bg-orange-500":Number(((B=(R=S(e))==null?void 0:R.corte[0])==null?void 0:B.dinero_inicio)||0)<=0}),disabled:Number(((M=(I=S(e))==null?void 0:I.corte[0])==null?void 0:M.dinero_inicio)||0)>0},"Guardar",10,Ce)])])):C("",!0),b.value?(h(),y("div",je,[r[9]||(r[9]=s("label",{for:"finalCash",class:"block text-sm font-medium text-gray-700"},"Cantidad Final en Caja",-1)),s("div",Ne,[N(s("input",{type:"number",id:"finalCash","onUpdate:modelValue":r[5]||(r[5]=d=>_.value=d),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"0",step:"0.01",placeholder:"Ingrese cantidad"},null,512),[[k,_.value]]),s("button",{onClick:re,class:J({"px-4 py-2 rounded-md text-white hover:bg-orange-600":Number(((L=(Z=S(e))==null?void 0:Z.corte[0])==null?void 0:L.dinero_final)||0)<=0,"bg-gray-500 px-4 py-2 rounded-md text-gray-300 cursor-not-allowed":Number(((G=(z=S(e))==null?void 0:z.corte[0])==null?void 0:G.dinero_final)||0)>0,"bg-orange-500":Number(((Q=(Y=S(e))==null?void 0:Y.corte[0])==null?void 0:Q.dinero_final)||0)<=0}),disabled:Number(((H=(W=S(e))==null?void 0:W.corte[0])==null?void 0:H.dinero_final)||0)>0},"Guardar",10,ke)])])):C("",!0),s("div",Ee,[r[15]||(r[15]=s("h2",{class:"text-xl font-semibold mb-4"},"Resumen Financiero",-1)),s("div",Fe,[s("div",null,[r[10]||(r[10]=s("p",{class:"text-sm text-gray-600"},"Dinero inicial:",-1)),s("p",Pe,"$"+w(F(c.value)),1)]),s("div",null,[r[11]||(r[11]=s("p",{class:"text-sm text-gray-600"},"Dinero final:",-1)),s("p",Oe,"$"+w(F(_.value)),1)]),s("div",null,[r[12]||(r[12]=s("p",{class:"text-sm text-gray-600"},"Efectivo:",-1)),s("p",Ue,"$"+w(F(x.value)),1)]),s("div",null,[r[13]||(r[13]=s("p",{class:"text-sm text-gray-600"},"Tarjetas:",-1)),s("p",De,"$"+w(v.value),1)]),s("div",null,[r[14]||(r[14]=s("p",{class:"text-sm text-gray-600"},"Total ventas:",-1)),s("p",Te,"$"+w(Number(x.value)+Number(v.value)),1)])])]),s("div",qe,[r[17]||(r[17]=s("h2",{class:"text-xl font-semibold mb-4"},"Productos Utilizados",-1)),s("div",Ve,[s("table",Ae,[r[16]||(r[16]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Producto"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cantidad")])],-1)),s("tbody",Re,[(h(!0),y(ne,null,le(p.value,d=>(h(),y("tr",{key:d.producto_id},[s("td",Be,[de(w(d.producto.nombre)+" - ",1),s("small",Ie,w(d.producto.detalle),1)]),s("td",Me,w(d.total_vendido),1)]))),128))])])])]),f.value?(h(),y("div",Ze,"Cargando...")):C("",!0)])])])}}},ze={class:"py-6"},Ge={class:"max-w-7xl w-full mx-auto sm:px-6 lg:px-8 rounded-xl"},Ye={class:"overflow-scroll md:overflow-hidden rounded-xl"},Ke={__name:"index",setup(j){return(e,t)=>(h(),ue(fe,{title:"Tablero principal"},{default:ce(()=>[s("div",ze,[s("div",Ge,[s("div",Ye,[pe(Le)])])])]),_:1}))}};export{Ke as default};
