import{S as C,_ as ae}from"./AppLayout-JB2XfN6N.js";import{Q as W,d as M,p as E,o as i,e as r,a as o,F as z,h as F,t as u,f as R,x as Z,i as se,j as q,l as Y,v as ee,z as U,k as ne,b as j,u as ie,B as re,y as G,g as J,n as X,C as le,c as te,w as de}from"./app-CnZ-6NJI.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as ue}from"./createLucideIcon-DnsHqfp7.js";/**
 * @license lucide-vue-next v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=ue("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),pe={class:"bg-white rounded-lg shadow-md overflow-hidden"},fe={class:"overflow-x-auto"},ve={class:"min-w-full divide-y divide-gray-200"},ge={class:"bg-white divide-y divide-gray-200"},xe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},be={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},we={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},_e={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},$e={key:0},He={class:"bg-gray-50"},ke={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Ee={__name:"PastesHorneados",setup($){const{props:x}=W();M(x.pastesHorneados);const T=E(()=>{const m={};x.pastesHorneados.forEach(l=>{m[l.relleno]||(m[l.relleno]={totalPiezas:0,items:[]}),m[l.relleno].totalPiezas+=Number(l.piezas),m[l.relleno].items.push(l)});const v=[];return Object.keys(m).forEach(l=>{m[l].items.forEach((g,D)=>{v.push({...g,totalPiezas:m[l].totalPiezas,isFirst:D===0})})}),v}),w=E(()=>T.value.reduce((m,v)=>Number(m)+(v.isFirst?Number(v.totalPiezas):0),0)),_=m=>new Date(m).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"America/Mexico_City"}),H=m=>new Date(m).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"America/Mexico_City"});return(m,v)=>(i(),r("div",null,[v[3]||(v[3]=o("h1",{class:"pb-4 pt-10 font-semibold text-xl"},"Pastes/Empanadas horneados de hoy",-1)),o("div",pe,[o("div",fe,[o("table",ve,[v[2]||(v[2]=o("thead",{class:"bg-gray-50"},[o("tr",null,[o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Responsable"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paste/Empanada"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hora"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Día"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Piezas Horneadas"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total del día")])],-1)),o("tbody",ge,[(i(!0),r(z,null,F(T.value,(l,g)=>{var D,S,N;return i(),r("tr",{key:g},[o("td",xe,u((D=l==null?void 0:l.responsable)==null?void 0:D.name)+" "+u(((S=l==null?void 0:l.responsable)==null?void 0:S.apellido_p)||"")+" "+u(((N=l==null?void 0:l.responsable)==null?void 0:N.apellido_m)||""),1),o("td",be,u(l.relleno),1),o("td",he,u(_(l.updated_at)),1),o("td",ye,u(H(l.updated_at)),1),o("td",we,u(l.piezas),1),o("td",_e,[l.isFirst?(i(),r("span",$e,u(l.totalPiezas),1)):R("",!0)])])}),128))]),o("tfoot",He,[o("tr",null,[v[0]||(v[0]=o("td",{colspan:"3",class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},"Total de piezas horneadas:",-1)),o("td",ke,u(w.value),1),v[1]||(v[1]=o("td",null,null,-1))])])])])])]))}},Te=ce(Ee,[["__scopeId","data-v-07cf8e5d"]]),De={class:"pt-16"},Ce={class:"max-w-7xl mx-auto space-y-6"},Se={class:"bg-white rounded-lg shadow p-6"},Me={class:"text-2xl font-bold text-gray-900"},ze={class:"mt-4"},Fe=["value"],Le={key:0,class:"bg-white rounded-lg shadow overflow-x-auto"},Pe={class:"min-w-full divide-y divide-gray-200"},Ne={class:"bg-gray-50"},Ve={class:"bg-white divide-y divide-gray-200"},Be={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ae=["onUpdate:modelValue"],Ie={key:1,class:"w-full flex justify-end"},je={__name:"EstimacionPastes",setup($){const{props:x}=W(),T=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],w=new Date().getDay(),_=T[w],H=M(_||"Lunes"),m=M(!1),v=[{value:"Lunes",label:"Lunes"},{value:"Martes",label:"Martes"},{value:"Miercoles",label:"Miércoles"},{value:"Jueves",label:"Jueves"},{value:"Viernes",label:"Viernes"},{value:"Sábado",label:"Sábado"},{value:"Domingo",label:"Domingo"}],l=["9:00 am","10:00 am","11:00 am","12:00 pm","1:00 pm","2:00 pm","3:00 pm","4:00 pm","5:00 pm","6:00 pm","7:00 pm","8:00 pm","9:00 pm"],g=E(()=>x.inventario.filter(b=>["pastes","empanadas dulces","empanadas saladas"].includes(b.tipo)).map(b=>b.nombre)),D=M({}),S=C.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:b=>{b.onmouseenter=C.stopTimer,b.onmouseleave=C.resumeTimer}}),N=()=>{const b={};return l.forEach(c=>{b[c]={},g.value.forEach(h=>{b[c][h]=0})}),b},V=()=>{m.value=!1,D.value=N(),x.estimaciones.filter(c=>c.dia===H.value).forEach(({hora:c,cantidad:h,inventario_id:P})=>{var d;const L=(d=x.inventario.find(s=>s.id===P))==null?void 0:d.nombre;L&&D.value[c]&&(D.value[c][L]=h)}),m.value=!0},B=()=>{U.post("/estimaciones",{estimaciones:D.value,dia:H.value},{preserveState:!1,preserveScroll:!0,onSuccess:()=>S.fire({icon:"success",title:"Sobrantes guardados exitosamente"}),onError:()=>S.fire({icon:"error",title:"Error al guardar los sobrantes"})})};return Z(()=>{V()}),se(H,()=>{V()}),(b,c)=>(i(),r("div",De,[o("div",Ce,[o("header",Se,[o("h1",Me,"Sistema de Control de Producción - Día: "+u(H.value),1),o("div",ze,[q(o("select",{"onUpdate:modelValue":c[0]||(c[0]=h=>H.value=h),class:"rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"},[(i(),r(z,null,F(v,h=>o("option",{key:h.value,value:h.value},u(h.label),9,Fe)),64))],512),[[Y,H.value]])])]),m.value?(i(),r("div",Le,[o("table",Pe,[o("thead",Ne,[o("tr",null,[c[1]||(c[1]=o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo",-1)),(i(!0),r(z,null,F(g.value,h=>(i(),r("th",{key:h,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},u(h),1))),128))])]),o("tbody",Ve,[(i(),r(z,null,F(l,h=>o("tr",{key:h},[o("td",Be,u(h),1),(i(!0),r(z,null,F(g.value,P=>(i(),r("td",{key:P,class:"px-6 py-4 whitespace-nowrap"},[q(o("input",{type:"number","onUpdate:modelValue":L=>D.value[h][P]=L,class:"w-20 rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500",min:"0"},null,8,Ae),[[ee,D.value[h][P]]])]))),128))])),64))])])])):R("",!0),b.$page.props.auth.user.roles[0].name=="admin"?(i(),r("div",Ie,[o("button",{onClick:B,class:"px-3 py-2 bg-orange-500 rounded-lg text-white hover:bg-orange-400"}," Guardar ")])):R("",!0)])]))}},Re={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Oe={class:"bg-white shadow rounded-lg p-6"},Ue={class:"mb-6"},qe={class:"list-disc pl-5"},We={class:"capitalize"},Ge={class:"font-semibold"},Je={class:"list-disc pl-5"},Ze={class:"font-semibold"},Qe={class:"bg-white shadow rounded-lg p-6"},Xe=["value"],Ke=["max"],Ye=["disabled"],et={class:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-4"},tt={class:"flex justify-between"},ot={class:"text-xl font-semibold mb-4"},at=["onClick"],st={key:0},nt={class:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4"},it={key:1},rt=["disabled"],lt={class:"mt-8 bg-white shadow rounded-lg p-6"},dt={key:0,class:"text-gray-500 text-center py-4"},ct={key:1,class:"divide-y divide-gray-200"},ut=["onClick"],mt={__name:"SistemaHorneado",setup($){const{props:x}=W(),T=x.inventario,w=M(x.hornos||[]),_=M(w.value.map(t=>({...t,horneando:t.estado||!1,pastesHorneando:t.pastesHorneando||[],tiempoInicio:t.tiempo_inicio?new Date(t.tiempo_inicio).getTime():0,tiempoFin:t.tiempo_fin?new Date(t.tiempo_fin).getTime():0,tiempoTranscurrido:0,timer:null,labeltime:"00:00"}))),H=M(10*1e3),m=M([]),v=()=>{if(m.value.length===0)return;const t=_.value.find(e=>!e.horneando);if(t){t.horneando=!0,t.pastesHorneando=[...m.value],m.value=[],t.tiempoInicio=Date.now(),t.tiempoFin=t.tiempoInicio+H.value;try{G.post("/iniciar-horneado",{horno_id:t.id,tiempo_inicio:t.tiempoInicio,tiempo_fin:t.tiempoFin,pastes_horneando:t.pastesHorneando,estado:!0}).then(e=>{}).catch(e=>{console.error("Error al iniciar el horneado:",e)}),C.fire({icon:"success",title:"Horneando",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),k(t.id)}catch(e){console.error("Error al iniciar el horneado:",e),C.fire({icon:"error",title:"Error al iniciar",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}}else O()},l=C.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:t=>{t.addEventListener("mouseenter",C.stopTimer),t.addEventListener("mouseleave",C.resumeTimer)}}),g=async t=>{console.log(`Horno ${t} - Iniciando finalización...`);const e=_.value.find(a=>a.id===t);if(!e||!e.horneando){console.log(`Horno ${t} - No se puede finalizar:`,{existe:!!e,horneando:e==null?void 0:e.horneando});return}try{if(await D(e)){clearInterval(e.timer);const n=[...e.pastesHorneando];e.horneando=!1,e.pastesHorneando=[],e.tiempoTranscurrido=0,e.labeltime="00:00",S();for(const f of n){const Q=T.find(I=>I.nombre.toLowerCase()===f.nombre.toLowerCase()&&(I.tipo==="pastes"||I.tipo==="empanadas saladas"||I.tipo==="empanadas dulces"));if(Q)try{await G.post("/api/control-produccion/horneado",{horno_id:t,paste_id:Q.id,cantidad:f.cantidad})}catch(I){console.error(`Horno ${t} - Error al registrar producción para ${f.nombre}:`,I)}else console.error(`Horno ${t} - No se encontró el paste ${f.nombre} en el inventario`)}await U.post("/hornear",{horno_id:t,pastes:n},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:()=>{l.fire({icon:"success",title:"Horneado finalizado"})},onError:f=>{console.error(`Horno ${t} - Error al registrar el horneado:`,f),l.fire({icon:"error",title:"Error al registrar el horneado"})}})}}catch(a){console.error(`Horno ${t} - Error en finalizarHorneado:`,a)}},D=async t=>{try{const e=await G.post("/check-estado",{horno_id:t.id,pastes:t.pastesHorneando});return console.log(`Horno ${t.id} - Respuesta de check-estado:`,e.data),e.data.estado}catch(e){return console.error(`Horno ${t.id} - Error al obtener el estado del horno:`,e),!1}},S=()=>{new Audio("/sound/videoplayback.mp3").play().catch(e=>console.error("Error al reproducir el sonido:",e))},N=E(()=>T.filter(t=>t.tipo==="masa")),V=E(()=>T.filter(t=>t.tipo==="relleno")),B=E(()=>N.value.map(t=>{const e=_.value.filter(a=>a.horneando&&a.pastesHorneando.some(n=>n.masa===t.nombre)).reduce((a,n)=>a+n.pastesHorneando.find(f=>f.masa===t.nombre).cantidad,0);return{...t,cantidad:t.cantidad-e}})),b=E(()=>V.value.map(t=>{const e=_.value.filter(a=>a.horneando&&a.pastesHorneando.some(n=>n.nombre===t.nombre)).reduce((a,n)=>a+n.pastesHorneando.find(f=>f.nombre===t.nombre).cantidad,0);return{...t,cantidad:t.cantidad-e}})),c=M({masa:"",relleno:"",cantidad:1,sucursal_id:x.auth.user.sucursal_id}),h=t=>{const e={pastes:"bola","empanadas saladas":"salada","empanadas dulces":"dulce"},a=x.inventario.find(n=>(n.nombre.toLowerCase()===t.value.relleno.toLowerCase()||n.nombre.toLowerCase().startsWith(t.value.relleno.toLowerCase()))&&e[n.tipo.toLowerCase()]);return a?e[a.tipo.toLowerCase()]:"bola"},P=()=>{const t=h(c).toLowerCase(),e=B.value.find(n=>n.nombre.toLowerCase()===t),a=b.value.find(n=>n.nombre.toLowerCase()===c.value.relleno.toLowerCase());if(!e||e.cantidad<=0){l.fire({icon:"error",title:"No hay suficiente masa disponible"});return}if(e&&a&&c.value.cantidad<=L.value){e.cantidad-=c.value.cantidad,a.cantidad-=c.value.cantidad;const n=m.value.find(f=>f.nombre===a.nombre);n?n.cantidad+=c.value.cantidad:p({id:Date.now(),masa:e.nombre,nombre:a.nombre,cantidad:c.value.cantidad,sucursal_id:x.auth.user.sucursal_id}),c.value={masa:"",relleno:"",cantidad:1,sucursal_id:x.auth.user.sucursal_id}}},L=E(()=>{const t=b.value.find(e=>e.nombre===c.value.relleno);return t?t.cantidad:1}),d=E(()=>c.value.relleno&&c.value.cantidad>0&&c.value.cantidad<=L.value);M("00:00");const s=t=>{if(t<=0)return"00:00";const e=Math.floor(t/1e3),a=Math.floor(e/60),n=e%60;return`${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`},p=t=>{m.value.push(t)},y=t=>{m.value=m.value.filter(e=>e.id!==t)},k=t=>{const e=_.value.find(f=>f.id===t);if(!e)return;const a=e.tiempoFin,n=a-Date.now();if(console.log(`Horno ${t} - Iniciando temporizador:`,{tiempoFin:new Date(a).toLocaleTimeString(),tiempoRestante:s(n),estado:e.horneando}),n<=0){console.log(`Horno ${t} - Tiempo ya pasó, finalizando...`),g(t);return}e.tiempoTranscurrido=H.value-n,e.labeltime=s(n),e.timer&&clearInterval(e.timer),e.timer=setInterval(()=>{const f=e.tiempoFin-Date.now();if(console.log(`Horno ${t} - Tick del temporizador:`,{tiempoRestante:s(f),labeltime:e.labeltime,estado:e.horneando}),f<=0){console.log(`Horno ${t} - Tiempo terminado, finalizando...`),clearInterval(e.timer),g(t);return}e.tiempoTranscurrido=H.value-f,e.labeltime=s(f)},1e3)},A=t=>{const e=_.value.find(f=>f.id===t);if(!e)return;const n=e.tiempoFin-Date.now();if(n<=0){g(t);return}console.log(n),e.tiempoTranscurrido=H.value-n,e.labeltime=s(n),e.timer&&clearInterval(e.timer),e.timer=setInterval(()=>{const f=e.tiempoFin-Date.now();if(f<=0){clearInterval(e.timer),g(t);return}console.log(f),e.tiempoTranscurrido=H.value-f,e.labeltime=s(f)},1e3)};Z(()=>{_.value.forEach(t=>{t.timer&&clearInterval(t.timer)}),console.log("Componente montado - Hornos activos:",_.value),_.value.forEach(t=>{if(t.estado){console.log(`Horno ${t.id} - Iniciando en onMounted:`,{estado:t.estado,tiempoInicio:new Date(t.tiempo_inicio).toLocaleTimeString(),tiempoFin:new Date(t.tiempo_fin).toLocaleTimeString()});const e=Date.now()-new Date(t.tiempo_inicio).getTime(),a=H.value-e;if(a<=0){console.log(`Horno ${t.id} - Tiempo ya pasó en onMounted, finalizando...`),g(t.id);return}t.tiempoFin=Date.now()+a,A(t.id)}})});const O=()=>{U.post("/crear-horno",{estado:!1,pastesHorneando:[]},{preserverScroll:!0,preserveState:!1,onSuccess:t=>{var e;w.value=(e=t==null?void 0:t.props)==null?void 0:e.hornos,m.value=[],_.value=w.value.map(a=>({...a,horneando:a.estado||!1,pastesHorneando:a.pastesHorneando||[],tiempoInicio:a.tiempo_inicio?new Date(a.tiempo_inicio).getTime():0,tiempoFin:a.tiempo_fin?new Date(a.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),C.fire({icon:"success",title:"Horno creado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:t=>{console.error("Error al crear el horno:",t),C.fire({icon:"error",title:"Error al crear horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})},oe=t=>{U.post("/eliminar-horno",{horno_id:t},{preserveScroll:!0,preserveState:!1,onSuccess:e=>{var a;w.value=(a=e==null?void 0:e.props)==null?void 0:a.hornos,_.value=w.value.map(n=>({...n,horneando:n.estado||!1,pastesHorneando:n.pastesHorneando||[],tiempoInicio:n.tiempo_inicio?new Date(n.tiempo_inicio).getTime():0,tiempoFin:n.tiempo_fin?new Date(n.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),C.fire({icon:"success",title:"Horno eliminado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:e=>{console.error("Error al eliminar el horno:",e),C.fire({icon:"error",title:"Error al eliminar horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})};return(t,e)=>(i(),r(z,null,[o("div",Re,[o("div",Oe,[e[4]||(e[4]=o("h2",{class:"text-xl font-semibold mb-4"},"Ingredientes Disponibles",-1)),o("div",Ue,[e[2]||(e[2]=o("h3",{class:"text-lg font-medium mb-2"},"Masas",-1)),o("ul",qe,[(i(!0),r(z,null,F(B.value,a=>(i(),r("li",{key:a.id,class:"flex justify-between"},[o("span",We,u(a.nombre),1),o("span",Ge,u(a.cantidad)+" unidades",1)]))),128))])]),o("div",null,[e[3]||(e[3]=o("h3",{class:"text-lg font-medium mb-2"},"Rellenos",-1)),o("ul",Je,[(i(!0),r(z,null,F(b.value,a=>(i(),r("li",{key:a.id,class:"flex justify-between"},[o("span",null,u(a.nombre),1),o("span",Ze,u(a.cantidad)+" unidades",1)]))),128))])])]),o("div",Qe,[e[8]||(e[8]=o("h2",{class:"text-xl font-semibold mb-4"},"Crear Nuevo Paste/Empanada",-1)),o("form",{onSubmit:ne(P,["prevent"]),class:"space-y-4"},[o("div",null,[e[6]||(e[6]=o("label",{for:"relleno",class:"block text-sm font-medium text-gray-700"},"Seleccionar Relleno",-1)),q(o("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>c.value.relleno=a),id:"relleno",required:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md"},[e[5]||(e[5]=o("option",{value:""},"Seleccione un relleno",-1)),(i(!0),r(z,null,F(V.value,a=>(i(),r("option",{key:a.id,value:a.nombre},u(a.nombre),9,Xe))),128))],512),[[Y,c.value.relleno]])]),o("div",null,[e[7]||(e[7]=o("label",{for:"cantidad",class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),q(o("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>c.value.cantidad=a),type:"number",id:"cantidad",required:"",min:"1",max:L.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm"},null,8,Ke),[[ee,c.value.cantidad,void 0,{number:!0}]])]),o("button",{type:"submit",disabled:!d.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Asignar Unidades ",8,Ye)],32)])]),o("div",et,[(i(!0),r(z,null,F(_.value,(a,n)=>(i(),r("div",{key:a.id,class:"bg-white shadow rounded-lg p-6"},[o("div",tt,[o("h2",ot,"Horno "+u(n+1),1),!a.horneando&&w.value.length>1?(i(),r("button",{key:0,onClick:f=>oe(a.id),class:"flex items-center gap-2 bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"},[j(ie(me),{class:"w-4 h-4"})],8,at)):R("",!0)]),a.horneando?(i(),r("div",st,[e[9]||(e[9]=o("p",{class:"text-lg mb-2"},"Horneando grupo de pastes:",-1)),o("ul",null,[(i(!0),r(z,null,F(a.pastesHorneando,f=>(i(),r("li",{key:f.nombre},u(f.cantidad)+" "+u(f.nombre)+" - masa "+u(f.masa),1))),128))]),o("div",nt,[o("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-100",style:re({width:`${a.tiempoTranscurrido/H.value*100}%`})},null,4)]),o("p",null,"Tiempo restante: "+u(a.labeltime),1)])):(i(),r("div",it,[e[10]||(e[10]=o("p",{class:"text-lg mb-4"},"El horno está disponible",-1)),o("button",{onClick:v,disabled:!m.value.length,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Iniciar Horneado de Grupo ",8,rt)]))]))),128)),o("div",{class:"mt-4 h-full flex justify-center items-center"},[o("button",{onClick:O,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}," Crear Nuevo Horno ")])]),o("div",lt,[e[11]||(e[11]=o("h2",{class:"text-xl font-semibold mb-4"},"Grupos de Pastes por Hornear",-1)),m.value.length===0?(i(),r("div",dt," No hay grupos de pastes en la cola de horneado ")):(i(),r("ul",ct,[(i(!0),r(z,null,F(m.value,a=>(i(),r("li",{key:a.id,class:"py-4 flex justify-between items-center"},[o("span",null,u(a.cantidad)+" "+u(a.nombre)+" - masa "+u(a.masa),1),o("button",{onClick:n=>y(a.id),class:"bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"}," Cancelar ",8,ut)]))),128))]))])],64))}},pt={class:"animate-pulse"},ft={key:0,class:"mt-2"},vt={class:"font-bold"},K={__name:"NotificationPanel",props:{notifications:{type:Array,required:!0},isVisible:{type:Boolean,default:!1},type:{type:String,required:!0,validator:$=>["warning","info"].includes($)},title:{type:String,required:!0}},emits:["toggle"],setup($){return(x,T)=>(i(),r("div",{class:X(["p-4 border rounded shadow mb-4 size-fit cursor-pointer",{"bg-yellow-100":$.type==="warning","bg-blue-100":$.type==="info"}]),onClick:T[0]||(T[0]=w=>x.$emit("toggle"))},[o("h2",{class:X(["text-lg font-bold text-center",{"text-yellow-800":$.type==="warning","text-blue-800":$.type==="info"}])},[J(u($.type==="warning"?"⚠️":"ℹ️")+" "+u($.title)+" ",1),o("span",pt,"("+u($.notifications.length)+")",1),J(" "+u($.type==="warning"?"⚠️":"ℹ️"),1)],2),$.isVisible?(i(),r("ul",ft,[(i(!0),r(z,null,F($.notifications,w=>(i(),r("li",{key:w.id,class:"mb-2"},[o("span",null,[o("span",vt,u(w.nombre),1),J(": "+u($.type==="warning"?"Faltan":"Hay")+" "+u($.type==="warning"?Math.abs(w.diferencia):w.diferencia)+" unidades para las "+u(w.hora),1)])]))),128))])):R("",!0)],2))}},gt={class:"container mx-auto p-4"},xt={class:"sm:flex justify-between flex-row text-sm"},bt={class:"flex gap-3 sm:flex-row flex-col"},ht={class:"mt-6"},yt={__name:"Hornear",setup($){const x=M(!1),T=M(!1),w=M(null),{props:_}=W(),H=E(()=>_.auth.user.roles[0].name==="admin"),m=E(()=>_.inventario||[]),v=E(()=>_.estimacionesHoy||[]);console.log("Props iniciales:",{inventario:m.value,estimaciones:v.value,isAdmin:H.value});const l=()=>{const d=new Date;return{day:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][d.getDay()].toLowerCase(),hour:d.getHours(),minutes:d.getMinutes()}},g=M(l()),D=d=>{const[s,p]=d.toLowerCase().split(" ");let[y,k]=s.split(":").map(Number);return{hours:p==="pm"&&y!==12?y+12:p==="am"&&y===12?0:y,minutes:k}},S=E(()=>m.value.filter(d=>{var s;return["pastes","empanadas dulces","empanadas saladas"].includes((s=d.tipo)==null?void 0:s.toLowerCase())}));console.log(S.value);const N=E(()=>{if(!v.value.length||!S.value.length)return console.log("No hay estimaciones o productos relevantes"),[];const d=new Map(S.value.map(p=>[p.id,p]));console.log("Productos relevantes:",S.value),console.log("Mapa de productos:",Object.fromEntries(d));const s=v.value.map(p=>{const y=d.get(p.inventario_id);if(!y)return console.log("Producto no encontrado para estimación:",p),null;const{hours:k}=D(p.hora);return{id:`${y.id}-${p.hora}`,nombre:y.nombre,estimado:p.cantidad,existente:y.cantidad,diferencia:y.cantidad-p.cantidad,hora:p.hora,dia:p.dia.toLowerCase(),horaEnNumero:k}}).filter(Boolean).filter((p,y,k)=>y===k.findIndex(A=>A.id===p.id));return console.log("Estimaciones vs Existentes:",s),s}),V=E(()=>{const d=N.value.filter(s=>s.dia===g.value.day);return console.log("Items del día:",{diaActual:g.value.day,items:d}),d}),B=E(()=>{const d=g.value.hour;console.log("Evaluando notificaciones actuales:",{horaActual:d,itemsDelDia:V.value});const s=V.value.filter(k=>k.horaEnNumero===d),p=new Map(s.map(k=>[k.nombre,k])),y=S.value.map(k=>{const A=p.get(k.nombre);if(A)return console.log("Producto existente en hora actual:",A),A;{const O={id:`${k.id}-${d}:00`,nombre:k.nombre,estimado:0,existente:k.cantidad,diferencia:k.cantidad,hora:`${d}:00`,dia:g.value.day,horaEnNumero:d};return console.log("Creando registro para producto sin estimación:",O),O}});return console.log("Notificaciones actuales filtradas:",y),y}),b=E(()=>{const d=B.value.filter(s=>{const p=s.estimado>0&&s.diferencia<0;return console.log("Evaluando faltante:",{item:s,diferencia:s.diferencia,esFaltante:p,estimado:s.estimado,existente:s.existente}),p});return console.log("Notificaciones faltantes finales:",d),d}),c=E(()=>{const d=B.value.filter(s=>{const p=s.estimado>0&&s.diferencia>0||s.estimado===0&&s.existente>0;return console.log("Evaluando excedente:",{item:s,diferencia:s.diferencia,esExcedente:p,estimado:s.estimado,existente:s.existente}),p});return console.log("Notificaciones excedentes finales:",d),d});console.log("Notificaciones excedentes:",c.value);const h=(d,s)=>{C.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,customClass:"no-print",didOpen:p=>{p.addEventListener("mouseenter",C.stopTimer),p.addEventListener("mouseleave",C.resumeTimer)}}).fire({icon:d,title:s})},P=()=>x.value=!x.value,L=()=>T.value=!T.value;return Z(()=>{console.log("Componente montado"),console.log("Estado inicial:",{currentTime:g.value,mostrarFaltantes:x.value,mostrarExcedentes:T.value,productosRelevantes:S.value});const d=setInterval(()=>{const s=l();console.log("Tiempo actualizado:",{anterior:g.value,nuevo:s}),g.value=s},1e3);w.value=setInterval(()=>{console.log("Verificando notificaciones..."),console.log("Estado actual de notificaciones:",{horaActual:g.value.hour,actuales:B.value,faltantes:b.value,excedentes:c.value});const s=b.value,p=c.value;console.log("Notificaciones a mostrar:",{horaActual:g.value.hour,faltantes:s,excedentes:p}),s.length>0,p.length>0&&p.forEach(y=>{console.log("Mostrando toast para excedente:",y),h("info",`Hay ${y.diferencia} unidades extra para las ${y.hora}`)})},6e4),le(()=>{clearInterval(d),clearInterval(w.value)})}),(d,s)=>(i(),r("div",gt,[o("div",xt,[s[0]||(s[0]=o("h1",{class:"text-2xl font-bold mb-4"},"Sistema de Horneado",-1)),o("div",bt,[j(K,{notifications:b.value,"is-visible":x.value,type:"warning",title:"Faltantes",onToggle:P},null,8,["notifications","is-visible"]),j(K,{notifications:c.value,"is-visible":T.value,type:"info",title:"Excedentes",onToggle:L},null,8,["notifications","is-visible"])])]),o("div",ht,[j(mt),j(Te),H.value?(i(),te(je,{key:0})):R("",!0)])]))}},wt={class:"py-6"},_t={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 rounded-xl overflow-hidden"},$t={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200 rounded-2xl"},Dt={__name:"index",setup($){return(x,T)=>(i(),te(ae,{title:"Tablero principal"},{default:de(()=>[o("div",wt,[o("div",_t,[o("div",$t,[j(yt)])])])]),_:1}))}};export{Dt as default};
