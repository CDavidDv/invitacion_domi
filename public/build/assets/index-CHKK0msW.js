import{_ as Q}from"./AppLayout-DXT_uVna.js";import{Q as y,d as f,k as j,o as i,e as d,a as e,l as k,q as B,F as h,h as x,t as a,y as V,s as F,c as N,w as A,b as D}from"./app-bDlwy9kh.js";import{S as _}from"./sweetalert2.esm.all-BGf-Fe8G.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const I={class:"container mx-auto"},O={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},L={class:"bg-white shadow rounded-lg p-6"},J={class:"flex gap-8 justify-between"},M={class:"text-lg font-semibold mb-2 text-gray-700"},U={class:"min-w-full"},q={class:"flex flex-col w-full"},R={class:"pl-6 text-sm text-gray-500"},z={class:"hidden sm:block"},G=["onClick","disabled"],H={class:"bg-white shadow rounded-lg p-6"},K={class:"min-w-full"},W={class:"pl-6 text-sm text-gray-500"},X=["onClick"],Y={class:"flex justify-end mt-4"},Z={class:"mt-4 flex justify-between items-center"},ee={class:"text-lg font-bold"},te=["disabled"],se={__name:"SalesPanel",setup(w){const{props:b}=y(),p=b.inventario,l=f([]),v=f(""),r=f("efectivo"),c=f(!1),T=["pastes","empanadas saladas","empanadas dulces","bebida","extras"],C={pastes:"Pastes","empanadas saladas":"Empanadas Saladas","empanadas dulces":"Empanadas Dulces",bebida:"Bebidas",extras:"Extras"},S=o=>p.filter(t=>t.tipo===o&&t.nombre.toLowerCase().includes(v.value.toLowerCase())),E=o=>{if(o.cantidad<=0)return;const t=l.value.find(s=>s.id===o.id);t?t.ticketQuantity++:l.value.push({...o,ticketQuantity:1}),o.cantidad--},$=o=>{const t=l.value.findIndex(s=>s.id===o);if(t!==-1){const s=l.value[t];s.ticketQuantity>1?s.ticketQuantity--:l.value.splice(t,1),p.find(n=>n.id===s.id).cantidad++}},m=j(()=>l.value.reduce((o,t)=>o+t.precio*t.ticketQuantity,0)),u=(o,t)=>{_.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:s=>{s.onmouseenter=_.stopTimer,s.onmouseleave=_.resumeTimer}}).fire({icon:o,title:t})},P=()=>{l.value.length!==0&&(c.value=!0,F.post("/ventas",{productos:l.value,total:m.value,metodo_pago:r.value},{preserveScroll:!0,onSuccess:o=>{g(o.props.ticket_id),g(o.props.ticket_id),p.value=o.props.inventario,l.value=[],v.value="",r.value="efectivo",u("success","Registrado correctamente"),c.value=!1},onError:o=>{console.error("Error al enviar el pedido:",o),u("error","Error al registrar"),c.value=!1}}))},g=o=>{console.log(JSON.stringify({ticket_id:o,productos:l.value,total:m.value,metodo_pago:r.value})),fetch("https://print.test/print-ticket",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productos:l.value,total:m.value,metodo_pago:r.value,ticket_id:o})}).then(t=>t.json()).then(t=>{t.success?u("success","Ticket impreso correctamente"):u("error","Error al imprimir el ticket")}).catch(t=>{console.error("Error en la impresión del ticket:",t),u("error","Error al imprimir el ticket")})};return(o,t)=>(i(),d("div",I,[t[7]||(t[7]=e("h1",{class:"text-2xl font-bold mb-4"},"Tablero de Ventas",-1)),e("div",O,[e("div",L,[e("div",J,[t[2]||(t[2]=e("h2",{class:"text-xl font-semibold mb-4"},"Inventario",-1)),k(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>v.value=s),placeholder:"Buscar en inventario...",class:"w-6/12 p-2 mb-4 border rounded"},null,512),[[B,v.value]])]),(i(),d(h,null,x(T,s=>e("div",{key:s,class:"mb-6 overflow-scroll md:overflow-hidden"},[e("h3",M,a(C[s]),1),e("table",U,[t[3]||(t[3]=e("thead",null,[e("tr",null,[e("th",{class:"text-left"},"Nombre"),e("th",{class:"text-left"},"Precio"),e("th",{class:"text-left hidden sm:block"},"Disponible"),e("th",{class:"text-left"},"Acción")])],-1)),e("tbody",null,[(i(!0),d(h,null,x(S(s),n=>(i(),d("tr",{key:n.id},[e("td",q,[e("p",null,a(n.nombre),1),e("p",R,a(n.detalle),1)]),e("td",null,"$"+a(n.precio),1),e("td",z,a(n.cantidad),1),e("td",null,[e("button",{onClick:ie=>E(n),disabled:n.cantidad===0,class:"px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50"}," Agregar ",8,G)])]))),128))])])])),64))]),e("div",H,[t[6]||(t[6]=e("h2",{class:"text-xl font-semibold mb-4"},"Ticket de Venta",-1)),e("table",K,[t[4]||(t[4]=e("thead",null,[e("tr",null,[e("th",{class:"text-left"},"Producto"),e("th",{class:"text-left"},"Cantidad"),e("th",{class:"text-left"},"Precio"),e("th",{class:"text-left"},"Acción")])],-1)),e("tbody",null,[(i(!0),d(h,null,x(l.value,s=>(i(),d("tr",{key:s.id},[e("td",null,[e("p",null,a(s.nombre),1),e("p",W,a(s.detalle),1)]),e("td",null,a(s.ticketQuantity),1),e("td",null,"$"+a((s.precio*s.ticketQuantity).toFixed(2)),1),e("td",null,[e("button",{onClick:n=>$(s.id),class:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600"}," Quitar ",8,X)])]))),128))])]),e("div",Y,[k(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>r.value=s),class:"rounded"},t[5]||(t[5]=[e("option",{value:"efectivo"},"Efectivo",-1),e("option",{value:"tarjeta"},"Tarjeta",-1)]),512),[[V,r.value]])]),e("div",Z,[e("span",ee,"Total: $"+a(m.value.toFixed(2)),1),e("button",{onClick:P,disabled:l.value.length===0||c.value,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50"},a(c.value?"Procesando...":"Completar Venta"),9,te)])])])]))}},oe={class:"py-6 px-2"},le={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ae={class:"bg-white overflow-hidden shadow-xl rounded-lg"},ne={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200"},pe={__name:"index",setup(w){const{props:b}=y();return console.log(b),(p,l)=>(i(),N(Q,{title:"Tablero principal"},{default:A(()=>[e("div",oe,[e("div",le,[e("div",ae,[e("div",ne,[D(se)])])])])]),_:1}))}};export{pe as default};
