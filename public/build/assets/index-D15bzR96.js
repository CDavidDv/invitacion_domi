import{S as H,_ as oe}from"./AppLayout--dR1vR0R.js";import{Q as j,d as _,p as f,o as r,e as l,a as e,F as D,h as E,t as u,f as N,x as R,i as ne,j as B,l as Z,v as Q,z as X,k as re,B as le,y as q,g as z,b as V,c as ie,w as de}from"./app-PysJEd8G.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ce={class:"bg-white rounded-lg shadow-md overflow-hidden"},me={class:"overflow-x-auto"},pe={class:"min-w-full divide-y divide-gray-200"},ve={class:"bg-white divide-y divide-gray-200"},fe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},be={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ge={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},xe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},_e={key:0},ye={class:"bg-gray-50"},we={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},$e={__name:"PastesHorneados",setup(F){const{props:d}=j();_(d.pastesHorneados);const C=f(()=>{const v={};d.pastesHorneados.forEach(m=>{v[m.relleno]||(v[m.relleno]={totalPiezas:0,items:[]}),v[m.relleno].totalPiezas+=Number(m.piezas),v[m.relleno].items.push(m)});const i=[];return Object.keys(v).forEach(m=>{v[m].items.forEach((y,k)=>{i.push({...y,totalPiezas:v[m].totalPiezas,isFirst:k===0})})}),i}),w=f(()=>C.value.reduce((v,i)=>Number(v)+(i.isFirst?Number(i.totalPiezas):0),0)),$=v=>new Date(v).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"America/Mexico_City"}),b=v=>new Date(v).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"America/Mexico_City"});return(v,i)=>(r(),l("div",null,[i[3]||(i[3]=e("h1",{class:"pb-4 pt-10 font-semibold text-xl"},"Pastes/Empanadas horneados de hoy",-1)),e("div",ce,[e("div",me,[e("table",pe,[i[2]||(i[2]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paste/Empanada"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hora"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Día"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Piezas Horneadas"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total del día")])],-1)),e("tbody",ve,[(r(!0),l(D,null,E(C.value,(m,y)=>(r(),l("tr",{key:y},[e("td",fe,u(m.relleno),1),e("td",be,u($(m.updated_at)),1),e("td",ge,u(b(m.created_at)),1),e("td",xe,u(m.piezas),1),e("td",he,[m.isFirst?(r(),l("span",_e,u(m.totalPiezas),1)):N("",!0)])]))),128))]),e("tfoot",ye,[e("tr",null,[i[0]||(i[0]=e("td",{colspan:"3",class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},"Total de piezas horneadas:",-1)),e("td",we,u(w.value),1),i[1]||(i[1]=e("td",null,null,-1))])])])])])]))}},ke=ue($e,[["__scopeId","data-v-d6bcbfb9"]]),De={class:"pt-16"},Ce={class:"max-w-7xl mx-auto space-y-6"},Ee={class:"bg-white rounded-lg shadow p-6"},Se={class:"text-2xl font-bold text-gray-900"},He={class:"mt-4"},Pe=["value"],Te={key:0,class:"bg-white rounded-lg shadow overflow-x-auto"},Le={class:"min-w-full divide-y divide-gray-200"},ze={class:"bg-gray-50"},Me={class:"bg-white divide-y divide-gray-200"},Fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ve=["onUpdate:modelValue"],Ne={__name:"EstimacionPastes",setup(F){const{props:d}=j(),C=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],w=new Date().getDay(),$=C[w],b=_($||"Lunes"),v=_(!1),i=[{value:"Lunes",label:"Lunes"},{value:"Martes",label:"Martes"},{value:"Miercoles",label:"Miércoles"},{value:"Jueves",label:"Jueves"},{value:"Viernes",label:"Viernes"},{value:"Sábado",label:"Sábado"},{value:"Domingo",label:"Domingo"}],m=["9:00 am","11:00 am","1:00 pm","3:00 pm","6:00 pm","9:00 pm"],y=f(()=>d.inventario.filter(g=>["pastes","empanadas dulces","empanadas saladas"].includes(g.tipo)).map(g=>g.nombre)),k=_({}),P=H.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:g=>{g.onmouseenter=H.stopTimer,g.onmouseleave=H.resumeTimer}}),T=()=>{const g={};return m.forEach(x=>{g[x]={},y.value.forEach(s=>{g[x][s]=0})}),g},S=()=>{v.value=!1,k.value=T(),d.estimaciones.filter(x=>x.dia===b.value).forEach(({hora:x,cantidad:s,inventario_id:n})=>{var c;const p=(c=d.inventario.find(M=>M.id===n))==null?void 0:c.nombre;p&&k.value[x]&&(k.value[x][p]=s)}),v.value=!0},L=()=>{X.post("/estimaciones",{estimaciones:k.value,dia:b.value},{preserveState:!1,preserveScroll:!0,onSuccess:()=>P.fire({icon:"success",title:"Sobrantes guardados exitosamente"}),onError:()=>P.fire({icon:"error",title:"Error al guardar los sobrantes"})})};return R(()=>{S()}),ne(b,()=>{S()}),(g,x)=>(r(),l("div",De,[e("div",Ce,[e("header",Ee,[e("h1",Se,"Sistema de Control de Producción - Día: "+u(b.value),1),e("div",He,[B(e("select",{"onUpdate:modelValue":x[0]||(x[0]=s=>b.value=s),class:"rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"},[(r(),l(D,null,E(i,s=>e("option",{key:s.value,value:s.value},u(s.label),9,Pe)),64))],512),[[Z,b.value]])])]),v.value?(r(),l("div",Te,[e("table",Le,[e("thead",ze,[e("tr",null,[x[1]||(x[1]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo",-1)),(r(!0),l(D,null,E(y.value,s=>(r(),l("th",{key:s,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},u(s),1))),128))])]),e("tbody",Me,[(r(),l(D,null,E(m,s=>e("tr",{key:s},[e("td",Fe,u(s),1),(r(!0),l(D,null,E(y.value,n=>(r(),l("td",{key:n,class:"px-6 py-4 whitespace-nowrap"},[B(e("input",{type:"number","onUpdate:modelValue":p=>k.value[s][n]=p,class:"w-20 rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500",min:"0"},null,8,Ve),[[Q,k.value[s][n]]])]))),128))])),64))])])])):N("",!0),e("div",{class:"w-full flex justify-end"},[e("button",{onClick:L,class:"px-3 py-2 bg-orange-500 rounded-lg text-white hover:bg-orange-400"}," Guardar ")])])]))}},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},je={class:"bg-white shadow rounded-lg p-6"},Ie={class:"mb-6"},Ae={class:"list-disc pl-5"},Re={class:"capitalize"},Oe={class:"font-semibold"},Ue={class:"list-disc pl-5"},We={class:"font-semibold"},Ge={class:"bg-white shadow rounded-lg p-6"},Je=["value"],qe=["max"],Ze=["disabled"],Qe={class:"mt-8 bg-white shadow rounded-lg p-6"},Xe={key:0},Ke={class:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4"},Ye={key:1},et=["disabled"],tt={class:"mt-8 bg-white shadow rounded-lg p-6"},st={key:0,class:"text-gray-500 text-center py-4"},at={key:1,class:"divide-y divide-gray-200"},ot=["onClick"],nt={__name:"SistemaHorneado",setup(F){var U,W,G,J;const{props:d}=j(),C=d.inventario,w=_(((U=d==null?void 0:d.horno)==null?void 0:U.estado)||!1),$=_(w.value&&((W=d==null?void 0:d.horno)!=null&&W.pastesHorneando)?d.horno.pastesHorneando:[]),b=_(15*60*1e3),v=_(0),i=_([]),m=_(w.value?new Date((G=d==null?void 0:d.horno)==null?void 0:G.tiempo_inicio).getTime():0),y=_(w.value?new Date((J=d==null?void 0:d.horno)==null?void 0:J.tiempo_fin).getTime():0);let k=null;const P=()=>{if(!(i.value.length===0||w.value)){w.value=!0,$.value=[...i.value],i.value=[],m.value=Date.now(),y.value=m.value+b.value;try{q.post("/iniciar-horneado",{tiempo_inicio:m.value,tiempo_fin:y.value,pastes_horneando:$.value,estado:!0}).then(o=>{console.log("Horneado iniciado:")}).catch(o=>{console.error("Error al iniciar el horneado:",o)}),H.fire({icon:"success",title:"Horneando",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),O()}catch(o){console.error("Error al iniciar el horneado:",o),H.fire({icon:"error",title:"Error al iniciar",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}}},T=H.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:o=>{o.addEventListener("mouseenter",H.stopTimer),o.addEventListener("mouseleave",H.resumeTimer)}}),S=()=>{if(L())return;clearInterval(k);const o=[...$.value];w.value=!1,$.value=[],v.value=0,g(),X.post("/hornear",{pastes:o},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:()=>{T.fire({icon:"success",title:"Horneado finalizado"})},onError:t=>{console.error("Error al registrar el horneado:",t),T.fire({icon:"error",title:"Error al registrar el horneado"})}})},L=()=>{q.post("/check-estado",{pastes:$.value}).then(o=>o.data.estado).catch(o=>(console.error("Error al obtener el estado del horno:",o),!1))},g=()=>{new Audio("/sound/videoplayback.mp3").play().catch(t=>console.error("Error al reproducir el sonido:",t))},x=f(()=>C.filter(o=>o.tipo==="masa")),s=f(()=>C.filter(o=>o.tipo==="relleno")),n=f(()=>x.value.map(o=>{const t=$.value.filter(a=>a.masa===o.nombre).reduce((a,h)=>a+h.cantidad,0);return{...o,cantidad:o.cantidad-t}})),p=f(()=>s.value.map(o=>{const t=$.value.filter(a=>a.nombre===o.nombre).reduce((a,h)=>a+h.cantidad,0);return{...o,cantidad:o.cantidad-t}})),c=_({masa:"",relleno:"",cantidad:1,sucursal_id:d.auth.user.sucursal_id}),M=o=>{const t={pastes:"bola","empanadas saladas":"salada","empanadas dulces":"dulce"},a=d.inventario.find(h=>(h.nombre.toLowerCase()===o.value.relleno.toLowerCase()||h.nombre.toLowerCase().startsWith(o.value.relleno.toLowerCase()))&&t[h.tipo.toLowerCase()]);return a?t[a.tipo.toLowerCase()]:"bola"},K=()=>{const o=M(c).toLowerCase(),t=n.value.find(h=>h.nombre.toLowerCase()===o),a=p.value.find(h=>h.nombre.toLowerCase()===c.value.relleno.toLowerCase());if(!t||t.cantidad<=0){T.fire({icon:"error",title:"No hay suficiente masa disponible"});return}if(t&&a&&c.value.cantidad<=I.value){t.cantidad-=c.value.cantidad,a.cantidad-=c.value.cantidad;const h=i.value.find(ae=>ae.nombre===a.nombre);h?h.cantidad+=c.value.cantidad:te({id:Date.now(),masa:t.nombre,nombre:a.nombre,cantidad:c.value.cantidad,sucursal_id:d.auth.user.sucursal_id}),c.value={masa:"",relleno:"",cantidad:1,sucursal_id:d.auth.user.sucursal_id}}},I=f(()=>{const o=p.value.find(t=>t.nombre===c.value.relleno);return o?o.cantidad:1}),Y=f(()=>c.value.relleno&&c.value.cantidad>0&&c.value.cantidad<=I.value),A=_("00:00"),ee=o=>{if(o<=0)return"00:00";const t=Math.floor(o/1e3),a=Math.floor(t/60),h=t%60;return`${String(a).padStart(2,"0")}:${String(h).padStart(2,"0")}`},te=o=>{i.value.push(o)},se=o=>{i.value=i.value.filter(t=>t.id!==o)},O=()=>{const o=y.value,t=o-Date.now();if(t<=0){S();return}v.value=b.value-t,k=setInterval(()=>{const a=o-Date.now();v.value=b.value-a,A.value=ee(a),console.log("tiempo transcurrido: ",A.value),a<=0&&S()},1e3)};return R(()=>{if(clearInterval(k),w.value){const o=Date.now()-m.value;y.value=Date.now()+(b.value-o),O()}}),(o,t)=>(r(),l(D,null,[e("div",Be,[e("div",je,[t[4]||(t[4]=e("h2",{class:"text-xl font-semibold mb-4"},"Ingredientes Disponibles",-1)),e("div",Ie,[t[2]||(t[2]=e("h3",{class:"text-lg font-medium mb-2"},"Masas",-1)),e("ul",Ae,[(r(!0),l(D,null,E(n.value,a=>(r(),l("li",{key:a.id,class:"flex justify-between"},[e("span",Re,u(a.nombre),1),e("span",Oe,u(a.cantidad)+" unidades",1)]))),128))])]),e("div",null,[t[3]||(t[3]=e("h3",{class:"text-lg font-medium mb-2"},"Rellenos",-1)),e("ul",Ue,[(r(!0),l(D,null,E(p.value,a=>(r(),l("li",{key:a.id,class:"flex justify-between"},[e("span",null,u(a.nombre),1),e("span",We,u(a.cantidad)+" unidades",1)]))),128))])])]),e("div",Ge,[t[8]||(t[8]=e("h2",{class:"text-xl font-semibold mb-4"},"Crear Nuevo Paste/Empanada",-1)),e("form",{onSubmit:re(K,["prevent"]),class:"space-y-4"},[e("div",null,[t[6]||(t[6]=e("label",{for:"relleno",class:"block text-sm font-medium text-gray-700"},"Seleccionar Relleno",-1)),B(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>c.value.relleno=a),id:"relleno",required:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md"},[t[5]||(t[5]=e("option",{value:""},"Seleccione un relleno",-1)),(r(!0),l(D,null,E(s.value,a=>(r(),l("option",{key:a.id,value:a.nombre},u(a.nombre),9,Je))),128))],512),[[Z,c.value.relleno]])]),e("div",null,[t[7]||(t[7]=e("label",{for:"cantidad",class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),B(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>c.value.cantidad=a),type:"number",id:"cantidad",required:"",min:"1",max:I.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm"},null,8,qe),[[Q,c.value.cantidad,void 0,{number:!0}]])]),e("button",{type:"submit",disabled:!Y.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Asignar Unidades ",8,Ze)],32)])]),e("div",Qe,[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold mb-4"},"Horno",-1)),w.value?(r(),l("div",Xe,[t[9]||(t[9]=e("p",{class:"text-lg mb-2"},"Horneando grupo de pastes:",-1)),e("ul",null,[(r(!0),l(D,null,E($.value,a=>(r(),l("li",{key:a.nombre},u(a.cantidad)+" "+u(a.nombre)+" - masa "+u(a.masa),1))),128))]),e("div",Ke,[e("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-100",style:le({width:`${v.value/b.value*100}%`})},null,4)]),e("p",null,"Tiempo restante: "+u(A.value),1)])):(r(),l("div",Ye,[t[10]||(t[10]=e("p",{class:"text-lg mb-4"},"El horno está disponible",-1)),e("button",{onClick:P,disabled:!i.value.length,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Iniciar Horneado de Grupo ",8,et)]))]),e("div",tt,[t[12]||(t[12]=e("h2",{class:"text-xl font-semibold mb-4"},"Grupos de Pastes por Hornear",-1)),i.value.length===0?(r(),l("div",st," No hay grupos de pastes en la cola de horneado ")):(r(),l("ul",at,[(r(!0),l(D,null,E(i.value,a=>(r(),l("li",{key:a.id,class:"py-4 flex justify-between items-center"},[e("span",null,u(a.cantidad)+" "+u(a.nombre)+" - masa "+u(a.masa),1),e("button",{onClick:h=>se(a.id),class:"bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"}," Cancelar ",8,ot)]))),128))]))])],64))}},rt={class:"container mx-auto p-4"},lt={class:"sm:flex justify-between flex-row text-sm"},it={class:"flex gap-3 sm:flex-row flex-col"},dt={class:"text-lg font-bold text-center text-yellow-800"},ut={class:"animate-pulse"},ct={key:0,class:"mt-2"},mt={class:"font-bold"},pt={class:"text-lg font-bold text-center text-blue-800"},vt={class:"animate-pulse"},ft={key:0,class:"mt-2"},bt={class:"font-bold"},gt={class:"mt-6"},xt={__name:"Hornear",setup(F){const d=_(!1),C=_(!1);function w(){d.value=!d.value}function $(){C.value=!C.value}const b=j(),v=f(()=>b.props.inventario||[]),i=f(()=>b.props.estimacionesHoy||[]),m=_(y());function y(){const s=new Date;return{day:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][s.getDay()].toLowerCase(),hour:s.getHours(),minutes:s.getMinutes()}}R(()=>{setInterval(()=>{m.value=y()},6e4)});function k(s){const[n,p]=s.toLowerCase().split(" ");let[c,M]=n.split(":").map(Number);return p==="pm"&&c!==12?c+=12:p==="am"&&c===12&&(c=0),{hours:c,minutes:M}}const P=f(()=>v.value.filter(s=>{var n;return["pastes","empanadas dulces","empanadas saladas"].includes((n=s.tipo)==null?void 0:n.toLowerCase())})),T=f(()=>!i.value.length||!P.value.length?[]:i.value.map(s=>{const n=P.value.find(c=>c.id===s.inventario_id);if(!n)return null;const{hours:p}=k(s.hora);return{id:`${n.id}-${s.hora}`,nombre:n.nombre,estimado:s.cantidad,existente:n.cantidad,diferencia:n.cantidad-s.cantidad,hora:s.hora,dia:s.dia.toLowerCase(),horaEnNumero:p}}).filter(Boolean).filter((s,n,p)=>n===p.findIndex(c=>c.id===s.id))),S=f(()=>T.value.filter(s=>s.dia===m.value.day));f(()=>S.value.filter(s=>s.diferencia<0)),f(()=>S.value.filter(s=>s.diferencia>0));const L=f(()=>S.value.filter(s=>{const n=m.value.hour;return Math.abs(s.horaEnNumero-n)<=1})),g=f(()=>L.value.filter(s=>s.diferencia<0)),x=f(()=>L.value.filter(s=>s.diferencia>0));return(s,n)=>(r(),l("div",rt,[e("div",lt,[n[4]||(n[4]=e("h1",{class:"text-2xl font-bold mb-4"},"Sistema de Horneado",-1)),e("div",it,[e("div",{class:"p-4 border rounded shadow bg-yellow-100 mb-4 size-fit cursor-pointer",onClick:w},[e("h2",dt,[n[0]||(n[0]=z(" ⚠️ Faltantes ")),e("span",ut,"("+u(g.value.length)+")",1),n[1]||(n[1]=z(" ⚠️ "))]),d.value?(r(),l("ul",ct,[(r(!0),l(D,null,E(g.value,p=>(r(),l("li",{key:p.id,class:"mb-2"},[e("span",null,[e("span",mt,u(p.nombre),1),z(": Faltan "+u(Math.abs(p.diferencia))+" unidades para las "+u(p.hora),1)])]))),128))])):N("",!0)]),e("div",{class:"p-4 border rounded shadow bg-blue-100 mb-4 size-fit cursor-pointer",onClick:$},[e("h2",pt,[n[2]||(n[2]=z(" ℹ️ Excedentes ")),e("span",vt,"("+u(x.value.length)+")",1),n[3]||(n[3]=z(" ℹ️ "))]),C.value?(r(),l("ul",ft,[(r(!0),l(D,null,E(x.value,p=>(r(),l("li",{key:p.id,class:"mb-2"},[e("span",null,[e("span",bt,u(p.nombre),1),z(": Hay "+u(p.diferencia)+" unidades extra para las "+u(p.hora),1)])]))),128))])):N("",!0)])])]),e("div",gt,[V(nt),V(ke),V(Ne)])]))}},ht={class:"py-6"},_t={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 rounded-xl overflow-hidden"},yt={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200 rounded-2xl"},Dt={__name:"index",setup(F){return(d,C)=>(r(),ie(oe,{title:"Tablero principal"},{default:de(()=>[e("div",ht,[e("div",_t,[e("div",yt,[V(xt)])])])]),_:1}))}};export{Dt as default};
