import{S,_ as U}from"./AppLayout-CAZNvB55.js";import{Q as z,d as c,p as D,o as l,e as a,a as t,j as w,v as L,F as h,h as x,t as r,f as p,l as j,n as O,z as A,c as M,w as R,b as q}from"./app-DU6dJyKx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"container mx-auto"},G={key:0,class:"text-2xl font-bold mb-4"},H={key:1,class:"text-2xl font-bold mb-4"},K={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},W={class:"bg-white shadow rounded-lg p-6"},X={class:"flex gap-8 justify-between"},Y=["placeholder"],Z={class:"text-lg font-semibold mb-2 text-gray-700 capitalize"},ee={class:"min-w-full"},te={key:0,class:"text-left"},se={class:"flex flex-col w-full"},oe={class:"pl-6 text-sm text-gray-500"},le={key:0},ae={class:"hidden sm:block"},ne=["onClick","disabled"],ie=["onClick","disabled"],re={class:"bg-white w-full shadow rounded-lg p-6"},de={key:0,class:"text-xl font-semibold mb-4"},ue={key:1,class:"text-xl font-semibold mb-4"},ce={key:2,class:"w-full flex flex-col gap-2 py-5"},pe={class:"w-full flex justify-between"},ve={key:0,class:"text-lg font-bold text-gray-600"},_e=["value"],fe={class:"w-full flex justify-between"},be={key:0,class:"text-lg w-full font-bold text-gray-600"},me=["value"],ge={class:"min-w-full"},he={key:0,class:"text-left"},xe={class:"pl-6 text-sm text-gray-500"},ke={key:0},ye=["onClick"],we={key:3,class:"flex justify-end mt-4"},Te={key:0,class:"text-lg font-bold"},Ce=["disabled"],Se=["disabled"],je={__name:"SalesPanel",setup(E){const{props:_}=z(),i=c(_.user.roles[0]==="almacen"),k=_.inventario,n=c([]),f=c(0),y=c(0),m=c(""),b=c("efectivo"),u=c(!1),T=c(),Q=c(_.sucursales.filter(o=>o.nombre!=="almacen")),V=c(_.trabajadores);i.value?T.value=_.categorias.map(o=>o.tipo):T.value=["pastes","empanadas saladas","empanadas dulces","bebida","extras"];const P=o=>k.filter(e=>e.nombre==="-"?"":e.tipo===o&&e.nombre.toLowerCase().includes(m.value.toLowerCase())),$=o=>{if(o.cantidad<=0)return;const e=n.value.find(s=>s.id===o.id);e?e.ticketQuantity++:n.value.push({...o,ticketQuantity:1}),o.cantidad--},B=o=>{const e=n.value.findIndex(s=>s.id===o);if(e!==-1){const s=n.value[e];s.ticketQuantity>1?s.ticketQuantity--:n.value.splice(e,1),k.find(d=>d.id===s.id).cantidad++}},C=D(()=>n.value.reduce((o,e)=>o+e.precio*e.ticketQuantity,0)),v=(o,e)=>{S.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:s=>{s.onmouseenter=S.stopTimer,s.onmouseleave=S.resumeTimer}}).fire({icon:o,title:e})},F=()=>{n.value.length!==0&&(u.value=!0,A.post("/ventas",{productos:n.value,total:C.value,metodo_pago:b.value},{preserveScroll:!0,onSuccess:o=>{g(o.props.ticket_id),g(o.props.ticket_id),k.value=o.props.inventario,n.value=[],m.value="",b.value="efectivo",v("success","Registrado correctamente"),u.value=!1},onError:o=>{console.error("Error al enviar el pedido:",o),v("error","Error al registrar"),u.value=!1}}))},N=()=>{if(n.value.length!==0){if(f.value===0){v("error","Seleccione una sucursal");return}u.value=!0,A.post("/asignar",{productos:n.value,sucursal_id:f.value,trabajador_id:y.value,total:"-",metodo_pago:"-"},{preserveScroll:!0,onSuccess:o=>{n.value.unshift({id:o.props.ticket_id||0,nombre:"Asignación ticket no.",detalle:`Sucursal: ${f.value}`,ticketQuantity:o.props.ticket_id||0,precio:0,sucursal_id:0,tipo:"asignacion"}),g(o.props.ticket_id),g(o.props.ticket_id),g(o.props.ticket_id),k.value=o.props.inventario,n.value=[],m.value="",f.value=0,y.value=0,b.value="efectivo",v("success","Registrado correctamente"),u.value=!1},onError:o=>{console.error("Error al enviar el pedido:",o),v("error","Error al registrar"),u.value=!1}})}},g=o=>{console.log(n.value),fetch("https://print.test/print-ticket",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productos:n.value,total:C.value||"-",metodo_pago:b.value||"-",ticket_id:o})}).then(e=>e.json()).then(e=>{e.success?v("success","Ticket impreso correctamente"):v("error","Error al imprimir el ticket")}).catch(e=>{console.error("Error en la impresión del ticket:",e),v("error","Error al imprimir el ticket")})};return(o,e)=>(l(),a("div",J,[i.value?(l(),a("h1",G,"Tablero de Asignación")):(l(),a("h1",H,"Tablero de Ventas")),t("div",K,[t("div",W,[t("div",X,[e[4]||(e[4]=t("h2",{class:"text-xl font-semibold mb-4"},"Inventario",-1)),w(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),placeholder:[i.value?"Buscar en almacén...":"Buscar en inventario..."],class:"w-6/12 p-2 mb-4 border rounded"},null,8,Y),[[L,m.value]])]),(l(!0),a(h,null,x(T.value,s=>(l(),a("div",{key:s,class:"mb-6 overflow-scroll md:overflow-hidden"},[t("h3",Z,r(s),1),t("table",ee,[t("thead",null,[t("tr",null,[e[5]||(e[5]=t("th",{class:"text-left"},"Nombre",-1)),i.value?p("",!0):(l(),a("th",te,"Precio")),e[6]||(e[6]=t("th",{class:"text-left hidden sm:block"},"Disponible",-1)),e[7]||(e[7]=t("th",{class:"text-left"},"Acción",-1))])]),t("tbody",null,[(l(!0),a(h,null,x(P(s),d=>(l(),a("tr",{key:d.id},[t("td",se,[t("p",null,r(d.nombre),1),t("p",oe,r(d.detalle),1)]),i.value?p("",!0):(l(),a("td",le,"$"+r(d.precio),1)),t("td",ae,r(d.cantidad),1),t("td",null,[i.value?(l(),a("button",{key:0,onClick:I=>$(d),disabled:d.cantidad===0,class:"px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50"}," Asignar ",8,ne)):(l(),a("button",{key:1,onClick:I=>$(d),disabled:d.cantidad===0,class:"px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50"}," Agregar ",8,ie))])]))),128))])])]))),128))]),t("div",re,[i.value?(l(),a("h2",de,"Ticket de Asignación")):(l(),a("h2",ue,"Ticket de Venta")),i.value?(l(),a("div",ce,[t("div",pe,[i.value?(l(),a("span",ve," Sucursal a la que se asignará ")):p("",!0),w(t("select",{class:"w-fit","onUpdate:modelValue":e[1]||(e[1]=s=>f.value=s)},[(l(!0),a(h,null,x(Q.value,s=>(l(),a("option",{key:s.id,value:s.id},r(s.nombre),9,_e))),128))],512),[[j,f.value]])]),t("div",fe,[i.value?(l(),a("span",be," Asignar responsable ")):p("",!0),w(t("select",{class:"w-fit","onUpdate:modelValue":e[2]||(e[2]=s=>y.value=s)},[e[8]||(e[8]=t("option",{value:"0"},"No asignar",-1)),(l(!0),a(h,null,x(V.value,s=>(l(),a("option",{key:s.id,value:s.id},r(s.name),9,me))),128))],512),[[j,y.value]])])])):p("",!0),t("table",ge,[t("thead",null,[t("tr",null,[e[9]||(e[9]=t("th",{class:"text-left"},"Producto",-1)),e[10]||(e[10]=t("th",{class:"text-left"},"Cantidad",-1)),i.value?p("",!0):(l(),a("th",he,"Precio")),e[11]||(e[11]=t("th",{class:"text-left"},"Acción",-1))])]),t("tbody",null,[(l(!0),a(h,null,x(n.value,s=>(l(),a("tr",{key:s.id},[t("td",null,[t("p",null,r(s.nombre),1),t("p",xe,r(s.detalle),1)]),t("td",null,r(s.ticketQuantity),1),i.value?p("",!0):(l(),a("td",ke,"$"+r((s.precio*s.ticketQuantity).toFixed(2)),1)),t("td",null,[t("button",{onClick:d=>B(s.id),class:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600"}," Quitar ",8,ye)])]))),128))])]),i.value?p("",!0):(l(),a("div",we,[w(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>b.value=s),class:"rounded"},e[12]||(e[12]=[t("option",{value:"efectivo"},"Efectivo",-1),t("option",{value:"tarjeta"},"Tarjeta",-1)]),512),[[j,b.value]])])),t("div",{class:O(["mt-4 flex  items-center",i.value?"justify-end":"justify-between"])},[i.value?p("",!0):(l(),a("span",Te,"Total: $"+r(C.value.toFixed(2)),1)),i.value?(l(),a("button",{key:2,onClick:N,disabled:n.value.length===0||u.value,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50"},r(u.value?"Procesando...":"Completar Asignacin"),9,Se)):(l(),a("button",{key:1,onClick:F,disabled:n.value.length===0||u.value,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50"},r(u.value?"Procesando...":"Completar Venta"),9,Ce))],2)])])]))}},$e={class:"py-6 px-2"},Ae={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Ee={class:"bg-white overflow-hidden shadow-xl rounded-lg"},Qe={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200"},Fe={__name:"index",setup(E){return(_,i)=>(l(),M(U,{title:"Tablero principal"},{default:R(()=>[t("div",$e,[t("div",Ae,[t("div",Ee,[t("div",Qe,[q(je)])])])])]),_:1}))}};export{Fe as default};
