import{_ as P}from"./AppLayout-BFTMx6F9.js";import{Q,d as m,k as j,o as r,e as i,a as e,l as g,q as B,F as b,h,t as l,y as V,s as F,c as N,w as A,b as D}from"./app-DymTawGI.js";import{S as x}from"./sweetalert2.esm.all-BGf-Fe8G.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const I={class:"container mx-auto"},L={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},O={class:"bg-white shadow rounded-lg p-6"},M={class:"flex gap-8 justify-between"},U={class:"text-lg font-semibold mb-2 text-gray-700"},q={class:"min-w-full"},J={class:"flex flex-col w-full"},R={class:"pl-6 text-sm text-gray-500"},z={class:"hidden sm:block"},G=["onClick","disabled"],H={class:"bg-white shadow rounded-lg p-6"},K={class:"min-w-full"},W={class:"pl-6 text-sm text-gray-500"},X=["onClick"],Y={class:"flex justify-end mt-4"},Z={class:"mt-4 flex justify-between items-center"},ee={class:"text-lg font-bold"},te=["disabled"],se={__name:"SalesPanel",setup(k){const{props:_}=Q(),p=_.inventario,a=m([]),v=m(""),d=m("efectivo"),c=m(!1),y=["pastes","empanadas saladas","empanadas dulces","bebida","extras"],w={pastes:"Pastes","empanadas saladas":"Empanadas Saladas","empanadas dulces":"Empanadas Dulces",bebida:"Bebidas",extras:"Extras"},T=o=>p.filter(t=>t.tipo===o&&t.nombre.toLowerCase().includes(v.value.toLowerCase())),C=o=>{if(o.cantidad<=0)return;const t=a.value.find(s=>s.id===o.id);t?t.ticketQuantity++:a.value.push({...o,ticketQuantity:1}),o.cantidad--},E=o=>{const t=a.value.findIndex(s=>s.id===o);if(t!==-1){const s=a.value[t];s.ticketQuantity>1?s.ticketQuantity--:a.value.splice(t,1),p.find(n=>n.id===s.id).cantidad++}},f=j(()=>a.value.reduce((o,t)=>o+t.precio*t.ticketQuantity,0)),u=(o,t)=>{x.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:s=>{s.onmouseenter=x.stopTimer,s.onmouseleave=x.resumeTimer}}).fire({icon:o,title:t})},S=()=>{$(),a.value.length!==0&&(c.value=!0,F.post("/ventas",{productos:a.value,total:f.value,metodo_pago:d.value},{preserveScroll:!0,onSuccess:o=>{p.value=o.props.inventario,a.value=[],v.value="",d.value="efectivo",u("success","Registrado correctamente"),c.value=!1},onError:o=>{console.error("Error al enviar el pedido:",o),u("error","Error al registrar"),c.value=!1}}))},$=()=>{fetch("http://print.test/print-ticket",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productos:a.value,total:f.value,metodo_pago:d.value})}).then(o=>o.json()).then(o=>{o.success?u("success","Ticket impreso correctamente"):u("error","Error al imprimir el ticket")}).catch(o=>{console.error("Error en la impresión del ticket:",o),u("error","Error al imprimir el ticket")})};return(o,t)=>(r(),i("div",I,[t[7]||(t[7]=e("h1",{class:"text-2xl font-bold mb-4"},"Tablero de Ventas",-1)),e("div",L,[e("div",O,[e("div",M,[t[2]||(t[2]=e("h2",{class:"text-xl font-semibold mb-4"},"Inventario",-1)),g(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>v.value=s),placeholder:"Buscar en inventario...",class:"w-6/12 p-2 mb-4 border rounded"},null,512),[[B,v.value]])]),(r(),i(b,null,h(y,s=>e("div",{key:s,class:"mb-6 overflow-scroll md:overflow-hidden"},[e("h3",U,l(w[s]),1),e("table",q,[t[3]||(t[3]=e("thead",null,[e("tr",null,[e("th",{class:"text-left"},"Nombre"),e("th",{class:"text-left"},"Precio"),e("th",{class:"text-left hidden sm:block"},"Disponible"),e("th",{class:"text-left"},"Acción")])],-1)),e("tbody",null,[(r(!0),i(b,null,h(T(s),n=>(r(),i("tr",{key:n.id},[e("td",J,[e("p",null,l(n.nombre),1),e("p",R,l(n.detalle),1)]),e("td",null,"$"+l(n.precio),1),e("td",z,l(n.cantidad),1),e("td",null,[e("button",{onClick:re=>C(n),disabled:n.cantidad===0,class:"px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50"}," Agregar ",8,G)])]))),128))])])])),64))]),e("div",H,[t[6]||(t[6]=e("h2",{class:"text-xl font-semibold mb-4"},"Ticket de Venta",-1)),e("table",K,[t[4]||(t[4]=e("thead",null,[e("tr",null,[e("th",{class:"text-left"},"Producto"),e("th",{class:"text-left"},"Cantidad"),e("th",{class:"text-left"},"Precio"),e("th",{class:"text-left"},"Acción")])],-1)),e("tbody",null,[(r(!0),i(b,null,h(a.value,s=>(r(),i("tr",{key:s.id},[e("td",null,[e("p",null,l(s.nombre),1),e("p",W,l(s.detalle),1)]),e("td",null,l(s.ticketQuantity),1),e("td",null,"$"+l((s.precio*s.ticketQuantity).toFixed(2)),1),e("td",null,[e("button",{onClick:n=>E(s.id),class:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600"}," Quitar ",8,X)])]))),128))])]),e("div",Y,[g(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>d.value=s),class:"rounded"},t[5]||(t[5]=[e("option",{value:"efectivo"},"Efectivo",-1),e("option",{value:"tarjeta"},"Tarjeta",-1)]),512),[[V,d.value]])]),e("div",Z,[e("span",ee,"Total: $"+l(f.value.toFixed(2)),1),e("button",{onClick:S,disabled:a.value.length===0||c.value,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50"},l(c.value?"Procesando...":"Completar Venta"),9,te)])])])]))}},oe={class:"py-6 px-2"},ae={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},le={class:"bg-white overflow-hidden shadow-xl rounded-lg"},ne={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200"},pe={__name:"index",setup(k){return(_,p)=>(r(),N(P,{title:"Tablero principal"},{default:A(()=>[e("div",oe,[e("div",ae,[e("div",le,[e("div",ne,[D(se)])])])])]),_:1}))}};export{pe as default};
